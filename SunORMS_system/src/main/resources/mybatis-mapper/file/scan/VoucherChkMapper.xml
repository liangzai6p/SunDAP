<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sunyard.ars.file.dao.scan.VoucherChkMapper">
  <resultMap id="BaseResultMap" type="com.sunyard.ars.file.pojo.scan.VoucherChk">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="ID" jdbcType="DECIMAL" property="id" />
    <result column="BUSINESS_ID" jdbcType="DECIMAL" property="businessId" />
    <result column="OCCUR_DATE" jdbcType="VARCHAR" property="occurDate" />
    <result column="SITE_NO" jdbcType="VARCHAR" property="siteNo" />
    <result column="OPERATOR_NO" jdbcType="VARCHAR" property="operatorNo" />
    <result column="INPUT_WORKER" jdbcType="VARCHAR" property="inputWorker" />
    <result column="REG_DATE" jdbcType="CHAR" property="regDate" />
    <result column="REG_TIME" jdbcType="CHAR" property="regTime" />
    <result column="BATCH_COMMIT" jdbcType="CHAR" property="batchCommit" />
    <result column="REG_VOUCHER_NUM" jdbcType="VARCHAR" property="regVoucherNum" />
    <result column="SCAN_VOUCHER_NUM" jdbcType="VARCHAR" property="scanVoucherNum" />
    <result column="AUTH_USER_NO" jdbcType="VARCHAR" property="authUserNo" />
    <result column="REASON" jdbcType="VARCHAR" property="reason" />
    <result column="AFFIRM_DATE" jdbcType="CHAR" property="affirmDate" />
    <result column="MEMO" jdbcType="VARCHAR" property="memo" />
    <result column="VOUCHER_CHECKOFF" jdbcType="VARCHAR" property="voucherCheckoff" />
    <result column="MACHINE_ID" jdbcType="VARCHAR" property="machineId" />
    <result column="UPLOAD_STATE" jdbcType="CHAR" property="uploadState" />
    <result column="IS_INVALID" jdbcType="CHAR" property="isInvalid" />
    <result column="BATCH_ID" jdbcType="CHAR" property="batchId" />
    <result column="NEED_PROCESS" jdbcType="CHAR" property="needProcess" />
    <result column="FORM_ID" jdbcType="VARCHAR" property="formId" />
    <result column="AFFIRM_TIME" jdbcType="VARCHAR" property="affirmTime" />
    <result column="PACKAGE_ID" jdbcType="VARCHAR" property="packageId" />
    <result column="IS_CLOSE" jdbcType="CHAR" property="isClose" />
    <result column="MAIN_VOUCHER_NUM" jdbcType="VARCHAR" property="mainVoucherNum" />
    <result column="SUB_VOUCHER_NUM" jdbcType="VARCHAR" property="subVoucherNum" />
    <result column="BATCH_TYPE" jdbcType="VARCHAR" property="batchType" />
    <result column="REG_WORKER" jdbcType="VARCHAR" property="regWorker" />
    <result column="MIXED_NP_FLAG" jdbcType="VARCHAR" property="mixedNpFlag" />
    <association property="businessType"  javaType="com.sunyard.ars.system.bean.sc.BusinessType" select="selectByBusinessId" column="BUSINESS_ID">
    </association>
  </resultMap>
  <resultMap extends="BaseResultMap" id="ResultMapWithTmpBatch" type="com.sunyard.ars.file.pojo.scan.VoucherChk">
    <association property="tmpBatch" javaType="com.sunyard.ars.common.pojo.TmpBatch" select ="com.sunyard.ars.common.dao.TmpBatchMapper.selectByPrimaryKey" column="BATCH_ID" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    ID, BUSINESS_ID, OCCUR_DATE, SITE_NO, OPERATOR_NO, INPUT_WORKER, REG_DATE, REG_TIME, 
    BATCH_COMMIT, REG_VOUCHER_NUM, SCAN_VOUCHER_NUM, AUTH_USER_NO, REASON, AFFIRM_DATE, 
    MEMO, VOUCHER_CHECKOFF, MACHINE_ID, UPLOAD_STATE, IS_INVALID, BATCH_ID, NEED_PROCESS, 
    FORM_ID, AFFIRM_TIME, PACKAGE_ID, IS_CLOSE, MAIN_VOUCHER_NUM, SUB_VOUCHER_NUM, BATCH_TYPE, 
    REG_WORKER, MIXED_NP_FLAG
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.math.BigDecimal" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from BP_VOUCHER_CHK_TB
    where ID = #{id,jdbcType=DECIMAL}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.math.BigDecimal">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from BP_VOUCHER_CHK_TB
    where ID = #{id,jdbcType=DECIMAL}
  </delete>
  <insert id="insert" parameterType="com.sunyard.ars.file.pojo.scan.VoucherChk">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into BP_VOUCHER_CHK_TB (ID, BUSINESS_ID, OCCUR_DATE, 
      SITE_NO, OPERATOR_NO, INPUT_WORKER, 
      REG_DATE, REG_TIME, BATCH_COMMIT, 
      REG_VOUCHER_NUM, SCAN_VOUCHER_NUM, AUTH_USER_NO, 
      REASON, AFFIRM_DATE, MEMO, 
      VOUCHER_CHECKOFF, MACHINE_ID, UPLOAD_STATE, 
      IS_INVALID, BATCH_ID, NEED_PROCESS, 
      FORM_ID, AFFIRM_TIME, PACKAGE_ID, 
      IS_CLOSE, MAIN_VOUCHER_NUM, SUB_VOUCHER_NUM, 
      BATCH_TYPE, REG_WORKER, MIXED_NP_FLAG
      )
    values (#{id,jdbcType=DECIMAL}, #{businessId,jdbcType=DECIMAL}, #{occurDate,jdbcType=VARCHAR}, 
      #{siteNo,jdbcType=VARCHAR}, #{operatorNo,jdbcType=VARCHAR}, #{inputWorker,jdbcType=VARCHAR}, 
      #{regDate,jdbcType=CHAR}, #{regTime,jdbcType=CHAR}, #{batchCommit,jdbcType=CHAR}, 
      #{regVoucherNum,jdbcType=VARCHAR}, #{scanVoucherNum,jdbcType=VARCHAR}, #{authUserNo,jdbcType=VARCHAR}, 
      #{reason,jdbcType=VARCHAR}, #{affirmDate,jdbcType=CHAR}, #{memo,jdbcType=VARCHAR}, 
      #{voucherCheckoff,jdbcType=VARCHAR}, #{machineId,jdbcType=VARCHAR}, #{uploadState,jdbcType=CHAR}, 
      #{isInvalid,jdbcType=CHAR}, #{batchId,jdbcType=CHAR}, #{needProcess,jdbcType=CHAR}, 
      #{formId,jdbcType=VARCHAR}, #{affirmTime,jdbcType=VARCHAR}, #{packageId,jdbcType=VARCHAR}, 
      #{isClose,jdbcType=CHAR}, #{mainVoucherNum,jdbcType=VARCHAR}, #{subVoucherNum,jdbcType=VARCHAR}, 
      #{batchType,jdbcType=VARCHAR}, #{regWorker,jdbcType=VARCHAR}, #{mixedNpFlag,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.sunyard.ars.file.pojo.scan.VoucherChk">
  	<selectKey resultType="java.math.BigDecimal" order="BEFORE" keyProperty="id">
  	SELECT seq_voucher_id.nextval as id from dual
  	</selectKey>
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into BP_VOUCHER_CHK_TB
    <trim prefix="(" suffix=")" suffixOverrides=",">
       ID,
      <if test="businessId != null">
        BUSINESS_ID,
      </if>
      <if test="occurDate != null">
        OCCUR_DATE,
      </if>
      <if test="siteNo != null">
        SITE_NO,
      </if>
      <if test="operatorNo != null">
        OPERATOR_NO,
      </if>
      <if test="inputWorker != null">
        INPUT_WORKER,
      </if>
      <if test="regDate != null">
        REG_DATE,
      </if>
      <if test="regTime != null">
        REG_TIME,
      </if>
      <if test="batchCommit != null">
        BATCH_COMMIT,
      </if>
      <if test="regVoucherNum != null">
        REG_VOUCHER_NUM,
      </if>
      <if test="scanVoucherNum != null">
        SCAN_VOUCHER_NUM,
      </if>
      <if test="authUserNo != null">
        AUTH_USER_NO,
      </if>
      <if test="reason != null">
        REASON,
      </if>
      <if test="affirmDate != null">
        AFFIRM_DATE,
      </if>
      <if test="memo != null">
        MEMO,
      </if>
      <if test="voucherCheckoff != null">
        VOUCHER_CHECKOFF,
      </if>
      <if test="machineId != null">
        MACHINE_ID,
      </if>
      <if test="uploadState != null">
        UPLOAD_STATE,
      </if>
      <if test="isInvalid != null">
        IS_INVALID,
      </if>
      <if test="batchId != null">
        BATCH_ID,
      </if>
      <if test="needProcess != null">
        NEED_PROCESS,
      </if>
      <if test="formId != null">
        FORM_ID,
      </if>
      <if test="affirmTime != null">
        AFFIRM_TIME,
      </if>
      <if test="packageId != null">
        PACKAGE_ID,
      </if>
      <if test="isClose != null">
        IS_CLOSE,
      </if>
      <if test="mainVoucherNum != null">
        MAIN_VOUCHER_NUM,
      </if>
      <if test="subVoucherNum != null">
        SUB_VOUCHER_NUM,
      </if>
      <if test="batchType != null">
        BATCH_TYPE,
      </if>
      <if test="regWorker != null">
        REG_WORKER,
      </if>
      <if test="mixedNpFlag != null">
        MIXED_NP_FLAG,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
        #{id,jdbcType=DECIMAL},
      <if test="businessId != null">
        #{businessId,jdbcType=DECIMAL},
      </if>
      <if test="occurDate != null">
        #{occurDate,jdbcType=VARCHAR},
      </if>
      <if test="siteNo != null">
        #{siteNo,jdbcType=VARCHAR},
      </if>
      <if test="operatorNo != null">
        #{operatorNo,jdbcType=VARCHAR},
      </if>
      <if test="inputWorker != null">
        #{inputWorker,jdbcType=VARCHAR},
      </if>
      <if test="regDate != null">
        #{regDate,jdbcType=CHAR},
      </if>
      <if test="regTime != null">
        #{regTime,jdbcType=CHAR},
      </if>
      <if test="batchCommit != null">
        #{batchCommit,jdbcType=CHAR},
      </if>
      <if test="regVoucherNum != null">
        #{regVoucherNum,jdbcType=VARCHAR},
      </if>
      <if test="scanVoucherNum != null">
        #{scanVoucherNum,jdbcType=VARCHAR},
      </if>
      <if test="authUserNo != null">
        #{authUserNo,jdbcType=VARCHAR},
      </if>
      <if test="reason != null">
        #{reason,jdbcType=VARCHAR},
      </if>
      <if test="affirmDate != null">
        #{affirmDate,jdbcType=CHAR},
      </if>
      <if test="memo != null">
        #{memo,jdbcType=VARCHAR},
      </if>
      <if test="voucherCheckoff != null">
        #{voucherCheckoff,jdbcType=VARCHAR},
      </if>
      <if test="machineId != null">
        #{machineId,jdbcType=VARCHAR},
      </if>
      <if test="uploadState != null">
        #{uploadState,jdbcType=CHAR},
      </if>
      <if test="isInvalid != null">
        #{isInvalid,jdbcType=CHAR},
      </if>
      <if test="batchId != null">
        #{batchId,jdbcType=CHAR},
      </if>
      <if test="needProcess != null">
        #{needProcess,jdbcType=CHAR},
      </if>
      <if test="formId != null">
        #{formId,jdbcType=VARCHAR},
      </if>
      <if test="affirmTime != null">
        #{affirmTime,jdbcType=VARCHAR},
      </if>
      <if test="packageId != null">
        #{packageId,jdbcType=VARCHAR},
      </if>
      <if test="isClose != null">
        #{isClose,jdbcType=CHAR},
      </if>
      <if test="mainVoucherNum != null">
        #{mainVoucherNum,jdbcType=VARCHAR},
      </if>
      <if test="subVoucherNum != null">
        #{subVoucherNum,jdbcType=VARCHAR},
      </if>
      <if test="batchType != null">
        #{batchType,jdbcType=VARCHAR},
      </if>
      <if test="regWorker != null">
        #{regWorker,jdbcType=VARCHAR},
      </if>
      <if test="mixedNpFlag != null">
        #{mixedNpFlag,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.sunyard.ars.file.pojo.scan.VoucherChk">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update BP_VOUCHER_CHK_TB
    <set>
      <if test="businessId != null">
        BUSINESS_ID = #{businessId,jdbcType=DECIMAL},
      </if>
      <if test="occurDate != null">
        OCCUR_DATE = #{occurDate,jdbcType=VARCHAR},
      </if>
      <if test="siteNo != null">
        SITE_NO = #{siteNo,jdbcType=VARCHAR},
      </if>
      <if test="operatorNo != null">
        OPERATOR_NO = #{operatorNo,jdbcType=VARCHAR},
      </if>
      <if test="inputWorker != null">
        INPUT_WORKER = #{inputWorker,jdbcType=VARCHAR},
      </if>
      <if test="regDate != null">
        REG_DATE = #{regDate,jdbcType=CHAR},
      </if>
      <if test="regTime != null">
        REG_TIME = #{regTime,jdbcType=CHAR},
      </if>
      <if test="batchCommit != null">
        BATCH_COMMIT = #{batchCommit,jdbcType=CHAR},
      </if>
      <if test="regVoucherNum != null">
        REG_VOUCHER_NUM = #{regVoucherNum,jdbcType=VARCHAR},
      </if>
      <if test="scanVoucherNum != null">
        SCAN_VOUCHER_NUM = #{scanVoucherNum,jdbcType=VARCHAR},
      </if>
      <if test="authUserNo != null">
        AUTH_USER_NO = #{authUserNo,jdbcType=VARCHAR},
      </if>
      <if test="reason != null">
        REASON = #{reason,jdbcType=VARCHAR},
      </if>
      <if test="affirmDate != null">
        AFFIRM_DATE = #{affirmDate,jdbcType=CHAR},
      </if>
      <if test="memo != null">
        MEMO = #{memo,jdbcType=VARCHAR},
      </if>
      <if test="voucherCheckoff != null">
        VOUCHER_CHECKOFF = #{voucherCheckoff,jdbcType=VARCHAR},
      </if>
      <if test="machineId != null">
        MACHINE_ID = #{machineId,jdbcType=VARCHAR},
      </if>
      <if test="uploadState != null">
        UPLOAD_STATE = #{uploadState,jdbcType=CHAR},
      </if>
      <if test="isInvalid != null">
        IS_INVALID = #{isInvalid,jdbcType=CHAR},
      </if>
      <if test="batchId != null">
        BATCH_ID = #{batchId,jdbcType=CHAR},
      </if>
      <if test="needProcess != null">
        NEED_PROCESS = #{needProcess,jdbcType=CHAR},
      </if>
      <if test="formId != null">
        FORM_ID = #{formId,jdbcType=VARCHAR},
      </if>
      <if test="affirmTime != null">
        AFFIRM_TIME = #{affirmTime,jdbcType=VARCHAR},
      </if>
      <if test="packageId != null">
        PACKAGE_ID = #{packageId,jdbcType=VARCHAR},
      </if>
      <if test="isClose != null">
        IS_CLOSE = #{isClose,jdbcType=CHAR},
      </if>
      <if test="mainVoucherNum != null">
        MAIN_VOUCHER_NUM = #{mainVoucherNum,jdbcType=VARCHAR},
      </if>
      <if test="subVoucherNum != null">
        SUB_VOUCHER_NUM = #{subVoucherNum,jdbcType=VARCHAR},
      </if>
      <if test="batchType != null">
        BATCH_TYPE = #{batchType,jdbcType=VARCHAR},
      </if>
      <if test="regWorker != null">
        REG_WORKER = #{regWorker,jdbcType=VARCHAR},
      </if>
      <if test="mixedNpFlag != null">
        MIXED_NP_FLAG = #{mixedNpFlag,jdbcType=VARCHAR},
      </if>
    </set>
    where ID = #{id,jdbcType=DECIMAL}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.sunyard.ars.file.pojo.scan.VoucherChk">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update BP_VOUCHER_CHK_TB
    set BUSINESS_ID = #{businessId,jdbcType=DECIMAL},
      OCCUR_DATE = #{occurDate,jdbcType=VARCHAR},
      SITE_NO = #{siteNo,jdbcType=VARCHAR},
      OPERATOR_NO = #{operatorNo,jdbcType=VARCHAR},
      INPUT_WORKER = #{inputWorker,jdbcType=VARCHAR},
      REG_DATE = #{regDate,jdbcType=CHAR},
      REG_TIME = #{regTime,jdbcType=CHAR},
      BATCH_COMMIT = #{batchCommit,jdbcType=CHAR},
      REG_VOUCHER_NUM = #{regVoucherNum,jdbcType=VARCHAR},
      SCAN_VOUCHER_NUM = #{scanVoucherNum,jdbcType=VARCHAR},
      AUTH_USER_NO = #{authUserNo,jdbcType=VARCHAR},
      REASON = #{reason,jdbcType=VARCHAR},
      AFFIRM_DATE = #{affirmDate,jdbcType=CHAR},
      MEMO = #{memo,jdbcType=VARCHAR},
      VOUCHER_CHECKOFF = #{voucherCheckoff,jdbcType=VARCHAR},
      MACHINE_ID = #{machineId,jdbcType=VARCHAR},
      UPLOAD_STATE = #{uploadState,jdbcType=CHAR},
      IS_INVALID = #{isInvalid,jdbcType=CHAR},
      BATCH_ID = #{batchId,jdbcType=CHAR},
      NEED_PROCESS = #{needProcess,jdbcType=CHAR},
      FORM_ID = #{formId,jdbcType=VARCHAR},
      AFFIRM_TIME = #{affirmTime,jdbcType=VARCHAR},
      PACKAGE_ID = #{packageId,jdbcType=VARCHAR},
      IS_CLOSE = #{isClose,jdbcType=CHAR},
      MAIN_VOUCHER_NUM = #{mainVoucherNum,jdbcType=VARCHAR},
      SUB_VOUCHER_NUM = #{subVoucherNum,jdbcType=VARCHAR},
      BATCH_TYPE = #{batchType,jdbcType=VARCHAR},
      REG_WORKER = #{regWorker,jdbcType=VARCHAR},
      MIXED_NP_FLAG = #{mixedNpFlag,jdbcType=VARCHAR}
    where ID = #{id,jdbcType=DECIMAL}
  </update>
  
  
  <select id="getVoucherChk" parameterType="com.sunyard.ars.file.pojo.scan.VoucherChk" resultMap="BaseResultMap">
       select  <include refid="Base_Column_List" />
    from BP_VOUCHER_CHK_TB
    <where>
      <if test="mixedNpFlag =='1'.toString()">
      AND MIXED_NP_FLAG='1' 
      AND IS_INVALID ='1' 
      AND  OCCUR_DATE = #{occurDate,jdbcType=VARCHAR} 
      AND SITE_NO = #{siteNo,jdbcType=VARCHAR} 
      AND OPERATOR_NO = #{operatorNo,jdbcType=VARCHAR} 
      </if>
      
      <if test="mixedNpFlag =='0'.toString()">
      AND MIXED_NP_FLAG='0' 
      AND IS_INVALID ='1'
      AND BUSINESS_ID = #{businessId,jdbcType=VARCHAR} 
      AND  OCCUR_DATE = #{occurDate,jdbcType=VARCHAR} 
      AND SITE_NO = #{siteNo,jdbcType=VARCHAR} 
      AND OPERATOR_NO = #{operatorNo,jdbcType=VARCHAR} 
      </if>
      </where>
  
  </select>
  
  <select id="getVoucherChkByBatchId" resultMap="BaseResultMap">
  select  *
    from BP_VOUCHER_CHK_TB where BATCH_ID = #{batchId}
  </select>
  
  <select id="selectByBusinessId" parameterType="java.math.BigDecimal" resultType="com.sunyard.ars.system.bean.sc.BusinessType">
    select BUSINESS_ID as businessId, BUSINESS_NAME as businessName,IS_NEED_PROCESS as isNeedProcess  from SM_BUSINESS_TB
    where BUSINESS_ID = #{BUSINESS_ID,jdbcType=DECIMAL} 
  </select>


  <sql id="selectByConditionSQL">
  	select * from BP_VOUCHER_CHK_TB B 
  	<where>
  	  <if test="startDate != null and startDate != ''">
        B.OCCUR_DATE &gt;= #{startDate,jdbcType=VARCHAR}
      </if>
  	  <if test="endDate != null and endDate != ''">
        AND B.OCCUR_DATE &lt;= #{endDate,jdbcType=VARCHAR}
      </if>
  	  <if test="isInvalid != null and isInvalid != ''">
        AND B.IS_INVALID = #{isInvalid,jdbcType=CHAR}
      </if>
      <if test="siteNoPrior == null or siteNoPrior == ''">
	      <if test="siteNo != null and siteNo != ''">
	        AND B.SITE_NO = #{siteNo,jdbcType=VARCHAR}
	      </if>
      </if>
      <if test="siteNoPrior != null and siteNoPrior != ''">
        AND EXISTS (SELECT T.ORGAN_NO FROM SM_ORGAN_TB T
        
       <if test="hasPrivOrganFlag != 0">
    	WHERE EXISTS ( SELECT 1 FROM SM_USER_ORGAN_TB UO WHERE T.ORGAN_NO=UO.ORGAN_NO AND UO.USER_NO=#{userNoPrior,jdbcType=VARCHAR} )   
        </if>
    	<if test="hasPrivOrganFlag == 0">
    	where EXISTS (select 1
		from sm_organ_tb sot, sm_organ_parent_tb sopt
		where
		exists (select 1
		from sm_users_tb sut
		where sut.user_no =#{userNoPrior,jdbcType=VARCHAR}
		and sot.organ_no = sut.organ_no)
		and sot.organ_no = sopt.parent_organ
		and sopt.organ_no=T.ORGAN_NO
		)
    	</if>
    	                   
    	AND T.ORGAN_NO=B.SITE_NO START WITH T.ORGAN_NO=#{siteNoPrior,jdbcType=VARCHAR} CONNECT BY T.PARENT_ORGAN=PRIOR T.ORGAN_NO)
      </if>
      <if test="operatorNo != null and operatorNo != ''">
        AND B.OPERATOR_NO = #{operatorNo,jdbcType=VARCHAR}
      </if>
      <if test="batchCommit != null and batchCommit != ''">
        AND B.BATCH_COMMIT = #{batchCommit,jdbcType=VARCHAR}
      </if>
      <if test="progressFlag != null and progressFlag != ''">
      	AND EXISTS ( SELECT 1 FROM BP_TMPBATCH_TB M WHERE M.PROGRESS_FLAG =  #{progressFlag,jdbcType=VARCHAR} 
      	 <if test="ocrFactorFlag != null and ocrFactorFlag != ''">
	        AND M.OCR_FACTOR_FLAG = #{ocrFactorFlag,jdbcType=VARCHAR}
	      </if>
      	AND M.BATCH_ID = B.BATCH_ID )
      </if>
       <if test="allCheckOff != null and allCheckOff != ''">
      	AND EXISTS ( SELECT 1 FROM  FL_CHECKOFF_TB F 
      	WHERE F.ALL_CHECKOFF=#{allCheckOff,jdbcType=VARCHAR} 
      	AND F.OPERATOR_NO=B.OPERATOR_NO
      	AND F.SITE_NO = B.SITE_NO 
      	AND F.OCCUR_DATE= B.OCCUR_DATE
      	 )
      </if>
      
  	</where>
  	order by B.ID
  </sql>
  
  <select id="selectByCondition" parameterType="Map" resultMap="BaseResultMap">
  	<include refid="selectByConditionSQL" />
  </select>
  <select id="selectByConditionWithTmpBatch" parameterType="Map" resultMap="ResultMapWithTmpBatch">
  	<include refid="selectByConditionSQL" />
  </select>
  
  <select id="isExists" parameterType="com.sunyard.ars.file.pojo.scan.VoucherChk" resultType = "Integer">
  	select count(1) from BP_VOUCHER_CHK_TB where 
  	BUSINESS_ID = #{businessId,jdbcType=VARCHAR} 
      AND  OCCUR_DATE = #{occurDate,jdbcType=VARCHAR} 
      AND SITE_NO = #{siteNo,jdbcType=VARCHAR} 
      AND IS_INVALID ='1'
      AND OPERATOR_NO = #{operatorNo,jdbcType=VARCHAR}
      <if test="id != null and id != ''">
      	AND ID &lt;&gt; #{id,jdbcType=DECIMAL}
      </if>
  </select>
  
  <update id="updateByBatchId" parameterType="java.util.HashMap">
    update BP_VOUCHER_CHK_TB
    <set>
      <if test="businessId != null">
        BUSINESS_ID = #{businessId,jdbcType=DECIMAL},
      </if>
      <if test="occurDate != null">
        OCCUR_DATE = #{occurDate,jdbcType=VARCHAR},
      </if>
      <if test="siteNo != null">
        SITE_NO = #{siteNo,jdbcType=VARCHAR},
      </if>
      <if test="operatorNo != null">
        OPERATOR_NO = #{operatorNo,jdbcType=VARCHAR},
      </if>
      <if test="batchCommit != null">
        BATCH_COMMIT = #{batchCommit,jdbcType=CHAR},
      </if>
      <if test="scanVoucherNum != null">
        SCAN_VOUCHER_NUM = #{scanVoucherNum,jdbcType=VARCHAR},
      </if>
      <if test="needProcess != null">
        NEED_PROCESS = #{needProcess,jdbcType=CHAR},
      </if>
      <if test="newIsInvalid != null">
        IS_INVALID = #{newIsInvalid,jdbcType=CHAR},
      </if>
      <if test="mixedNpFlag != null">
        MIXED_NP_FLAG = #{mixedNpFlag,jdbcType=VARCHAR},
      </if>
    </set>
    where BATCH_ID = #{batchId,jdbcType=CHAR}
  </update>
  
    <select id="getUnScanedTeller" resultType="java.util.HashMap">
  		select distinct f.operator_no, f.site_no, f.occur_date
  from fl_flow_tb f
 where not exists (select 1
          from bp_tmpbatch_tb b
         where b.operator_no=f.operator_no
              and b.site_no = f.site_no
           and b.occur_date = f.occur_date)
   and f.IS_INVALID='1'
   
   <if test="hasPrivOrganFlag != 0">
   and f.site_no in (select o.organ_no from sm_user_organ_tb o where o.user_no =#{userNo,jdbcType=VARCHAR} )
   </if>
   <if test="hasPrivOrganFlag == 0">
   	AND EXISTS (select 1
		from sm_organ_tb sot, sm_organ_parent_tb sopt
		where
		exists (select 1
		from sm_users_tb sut
		where sut.user_no = #{userNo,jdbcType=VARCHAR} 
		and sot.organ_no = sut.organ_no)
		and sot.organ_no = sopt.parent_organ
		and sopt.organ_no=f.site_no
		)
   </if>   
   and f.occur_date &gt;= #{SoccurDate,jdbcType=VARCHAR} 
   and f.occur_date &lt;= #{EoccurDate,jdbcType=VARCHAR}
  
  </select>
  
  
</mapper>