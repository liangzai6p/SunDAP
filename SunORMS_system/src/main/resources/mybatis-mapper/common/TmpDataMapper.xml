<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sunyard.ars.common.dao.TmpDataMapper">
  <resultMap id="BaseResultMap" type="com.sunyard.ars.common.pojo.TmpData">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="SERIAL_NO" jdbcType="VARCHAR" property="serialNo" />
    <result column="BATCH_ID" jdbcType="CHAR" property="batchId" />
    <result column="INCCODEIN_BATCH" jdbcType="DECIMAL" property="inccodeinBatch" />
    <result column="COPY_INCCODEIN" jdbcType="DECIMAL" property="copyInccodein" />
    <result column="COPY_REC" jdbcType="DECIMAL" property="copyRec" />
    <result column="IS_FRONT_PAGE" jdbcType="CHAR" property="isFrontPage" />
    <result column="PS_LEVEL" jdbcType="CHAR" property="psLevel" />
    <result column="PRIMARY_INCCODEIN" jdbcType="DECIMAL" property="primaryInccodein" />
    <result column="FORM_NAME" jdbcType="VARCHAR" property="formName" />
    <result column="FORM_GROUP" jdbcType="VARCHAR" property="formGroup" />
    <result column="VOUH_TYPE" jdbcType="VARCHAR" property="vouhType" />
    <result column="CHECK_FLAG" jdbcType="VARCHAR" property="checkFlag" />
    <result column="ERROR_FLAG" jdbcType="CHAR" property="errorFlag" />
    <result column="IS_AUDIT" jdbcType="CHAR" property="isAudit" />
    <result column="SELF_DELETE" jdbcType="CHAR" property="selfDelete" />
    <result column="MEMO" jdbcType="VARCHAR" property="memo" />
    <result column="PROCESS_STATE" jdbcType="VARCHAR" property="processState" />
    <result column="REC_DATE" jdbcType="CHAR" property="recDate" />
    <result column="REC_FAIL_CAUSE" jdbcType="VARCHAR" property="recFailCause" />
    <result column="FLOW_ID" jdbcType="VARCHAR" property="flowId" />
    <result column="IMAGE_SIZE" jdbcType="DECIMAL" property="imageSize" />
    <result column="BACK_IMAGE_SIZE" jdbcType="DECIMAL" property="backImageSize" />
    <result column="PATCH_FLAG" jdbcType="DECIMAL" property="patchFlag" />
    <result column="FILE_NAME" jdbcType="VARCHAR" property="fileName" />
    <result column="BACK_FILE_NAME" jdbcType="VARCHAR" property="backFileName" />
    <result column="OCR_WORKER" jdbcType="VARCHAR" property="ocrWorker" />
    <result column="OCR_DATE" jdbcType="CHAR" property="ocrDate" />
    <result column="OCR_TIME" jdbcType="CHAR" property="ocrTime" />
    <result column="COPY_SERIALNO" jdbcType="VARCHAR" property="copySerialno" />
    <result column="IS_SIGN" jdbcType="CHAR" property="isSign" />
    <result column="SUPERVISE_DEAL" jdbcType="CHAR" property="superviseDeal" />
    <result column="CONTENT_ID" jdbcType="VARCHAR" property="contentId" />
    <result column="DATA_SOURCE_ID" jdbcType="VARCHAR" property="dataSourceId" />
    <result column="VOUCHER_NUMBER" jdbcType="DECIMAL" property="voucherNumber" />
    <result column="FORM_ID" jdbcType="VARCHAR" property="formId" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    SERIAL_NO, BATCH_ID, INCCODEIN_BATCH, COPY_INCCODEIN, COPY_REC, IS_FRONT_PAGE, PS_LEVEL, 
    PRIMARY_INCCODEIN, FORM_NAME, FORM_GROUP, VOUH_TYPE, CHECK_FLAG, ERROR_FLAG, IS_AUDIT, 
    SELF_DELETE, MEMO, PROCESS_STATE, REC_DATE, REC_FAIL_CAUSE, FLOW_ID, IMAGE_SIZE, 
    BACK_IMAGE_SIZE, PATCH_FLAG, FILE_NAME, BACK_FILE_NAME, OCR_WORKER, OCR_DATE, OCR_TIME, 
    COPY_SERIALNO, IS_SIGN, SUPERVISE_DEAL, CONTENT_ID, DATA_SOURCE_ID, VOUCHER_NUMBER, 
    FORM_ID
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from BP_TMPDATA_1_TB
    where SERIAL_NO = #{serialNo,jdbcType=VARCHAR}
  </select>
  
  <select id="selectByBatchId"  resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from BP_TMPDATA_1_TB
    <where>
    	<if test="queryType != null">
		  	<choose>
		  		<when test='queryType == "1"'><!--未处理-->
		  		　CHECK_FLAG = '-1' AND SELF_DELETE = '0' 
		  		</when>
		  		<when test='queryType == "2"'><!--已处理-->
		  		　CHECK_FLAG != '-1' and SELF_DELETE = '0'
		  		</when>
		  		<when test='queryType == "3"'><!--已标记-->
		  		　(SELF_DELETE = '1' or IS_AUDIT = '1' or ERROR_FLAG = '1' or substr(PROCESS_STATE,4,1) = '1')
		  		</when>
		  	</choose>
		</if>
	    AND BATCH_ID = #{batchId,jdbcType=VARCHAR}
    </where> 
    order by INCCODEIN_BATCH
  </select>
  
  <insert id="insert" parameterType="com.sunyard.ars.common.pojo.TmpData">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into BP_TMPDATA_1_TB (SERIAL_NO, BATCH_ID, INCCODEIN_BATCH, 
      COPY_INCCODEIN, COPY_REC, IS_FRONT_PAGE, 
      PS_LEVEL, PRIMARY_INCCODEIN, FORM_NAME, 
      FORM_GROUP, VOUH_TYPE, CHECK_FLAG, 
      ERROR_FLAG, IS_AUDIT, SELF_DELETE, 
      MEMO, PROCESS_STATE, REC_DATE, 
      REC_FAIL_CAUSE, FLOW_ID, IMAGE_SIZE, 
      BACK_IMAGE_SIZE, PATCH_FLAG, FILE_NAME, 
      BACK_FILE_NAME, OCR_WORKER, OCR_DATE, 
      OCR_TIME, COPY_SERIALNO, IS_SIGN, 
      SUPERVISE_DEAL, CONTENT_ID, DATA_SOURCE_ID, 
      VOUCHER_NUMBER, FORM_ID)
    values (#{serialNo,jdbcType=VARCHAR}, #{batchId,jdbcType=CHAR}, #{inccodeinBatch,jdbcType=DECIMAL}, 
      #{copyInccodein,jdbcType=DECIMAL}, #{copyRec,jdbcType=DECIMAL}, #{isFrontPage,jdbcType=CHAR}, 
      #{psLevel,jdbcType=CHAR}, #{primaryInccodein,jdbcType=DECIMAL}, #{formName,jdbcType=VARCHAR}, 
      #{formGroup,jdbcType=VARCHAR}, #{vouhType,jdbcType=VARCHAR}, #{checkFlag,jdbcType=VARCHAR}, 
      #{errorFlag,jdbcType=CHAR}, #{isAudit,jdbcType=CHAR}, #{selfDelete,jdbcType=CHAR}, 
      #{memo,jdbcType=VARCHAR}, #{processState,jdbcType=VARCHAR}, #{recDate,jdbcType=CHAR}, 
      #{recFailCause,jdbcType=VARCHAR}, #{flowId,jdbcType=VARCHAR}, #{imageSize,jdbcType=DECIMAL}, 
      #{backImageSize,jdbcType=DECIMAL}, #{patchFlag,jdbcType=DECIMAL}, #{fileName,jdbcType=VARCHAR}, 
      #{backFileName,jdbcType=VARCHAR}, #{ocrWorker,jdbcType=VARCHAR}, #{ocrDate,jdbcType=CHAR}, 
      #{ocrTime,jdbcType=CHAR}, #{copySerialno,jdbcType=VARCHAR}, #{isSign,jdbcType=CHAR}, 
      #{superviseDeal,jdbcType=CHAR}, #{contentId,jdbcType=VARCHAR}, #{dataSourceId,jdbcType=VARCHAR}, 
      #{voucherNumber,jdbcType=DECIMAL}, #{formId,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into
    <if test="dataTb.indexOf('HIS') != -1  or dataTb.indexOf('his') != -1">
      BP_TMPDATA_1_TB_HIS
    </if>
    <if test="dataTb.indexOf('HIS') == -1 and dataTb.indexOf('his') == -1">
      BP_TMPDATA_1_TB
    </if>
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="tmpdata.serialNo != null">
        SERIAL_NO,
      </if>
      <if test="tmpdata.batchId != null">
        BATCH_ID,
      </if>
      <if test="tmpdata.inccodeinBatch != null">
        INCCODEIN_BATCH,
      </if>
      <if test="tmpdata.copyInccodein != null">
        COPY_INCCODEIN,
      </if>
      <if test="tmpdata.copyRec != null">
        COPY_REC,
      </if>
      <if test="tmpdata.isFrontPage != null">
        IS_FRONT_PAGE,
      </if>
      <if test="tmpdata.psLevel != null">
        PS_LEVEL,
      </if>
      <if test="tmpdata.primaryInccodein != null">
        PRIMARY_INCCODEIN,
      </if>
      <if test="tmpdata.formName != null">
        FORM_NAME,
      </if>
      <if test="tmpdata.formGroup != null">
        FORM_GROUP,
      </if>
      <if test="tmpdata.vouhType != null">
        VOUH_TYPE,
      </if>
      <if test="tmpdata.checkFlag != null">
        CHECK_FLAG,
      </if>
      <if test="tmpdata.errorFlag != null">
        ERROR_FLAG,
      </if>
      <if test="tmpdata.isAudit != null">
        IS_AUDIT,
      </if>
      <if test="tmpdata.selfDelete != null">
        SELF_DELETE,
      </if>
      <if test="tmpdata.memo != null">
        MEMO,
      </if>
      <if test="tmpdata.processState != null">
        PROCESS_STATE,
      </if>
      <if test="tmpdata.recDate != null">
        REC_DATE,
      </if>
      <if test="tmpdata.recFailCause != null">
        REC_FAIL_CAUSE,
      </if>
      <if test="tmpdata.flowId != null">
        FLOW_ID,
      </if>
      <if test="tmpdata.imageSize != null">
        IMAGE_SIZE,
      </if>
      <if test="tmpdata.backImageSize != null">
        BACK_IMAGE_SIZE,
      </if>
      <if test="tmpdata.patchFlag != null">
        PATCH_FLAG,
      </if>
      <if test="tmpdata.fileName != null">
        FILE_NAME,
      </if>
      <if test="tmpdata.backFileName != null">
        BACK_FILE_NAME,
      </if>
      <if test="tmpdata.ocrWorker != null">
        OCR_WORKER,
      </if>
      <if test="tmpdata.ocrDate != null">
        OCR_DATE,
      </if>
      <if test="tmpdata.ocrTime != null">
        OCR_TIME,
      </if>
      <if test="tmpdata.copySerialno != null">
        COPY_SERIALNO,
      </if>
      <if test="tmpdata.isSign != null">
        IS_SIGN,
      </if>
      <if test="tmpdata.superviseDeal != null">
        SUPERVISE_DEAL,
      </if>
      <if test="tmpdata.contentId != null">
        CONTENT_ID,
      </if>
      <if test="tmpdata.dataSourceId != null">
        DATA_SOURCE_ID,
      </if>
      <if test="tmpdata.voucherNumber != null">
        VOUCHER_NUMBER,
      </if>
      <if test="tmpdata.formId != null">
        FORM_ID,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="tmpdata.serialNo != null">
        #{tmpdata.serialNo,jdbcType=VARCHAR},
      </if>
      <if test="tmpdata.batchId != null">
        #{tmpdata.batchId,jdbcType=CHAR},
      </if>
      <if test="tmpdata.inccodeinBatch != null">
        #{tmpdata.inccodeinBatch,jdbcType=DECIMAL},
      </if>
      <if test="tmpdata.copyInccodein != null">
        #{tmpdata.copyInccodein,jdbcType=DECIMAL},
      </if>
      <if test="tmpdata.copyRec != null">
        #{tmpdata.copyRec,jdbcType=DECIMAL},
      </if>
      <if test="tmpdata.isFrontPage != null">
        #{tmpdata.isFrontPage,jdbcType=CHAR},
      </if>
      <if test="tmpdata.psLevel != null">
        #{tmpdata.psLevel,jdbcType=CHAR},
      </if>
      <if test="tmpdata.primaryInccodein != null">
        #{tmpdata.primaryInccodein,jdbcType=DECIMAL},
      </if>
      <if test="tmpdata.formName != null">
        #{tmpdata.formName,jdbcType=VARCHAR},
      </if>
      <if test="tmpdata.formGroup != null">
        #{tmpdata.formGroup,jdbcType=VARCHAR},
      </if>
      <if test="tmpdata.vouhType != null">
        #{tmpdata.vouhType,jdbcType=VARCHAR},
      </if>
      <if test="tmpdata.checkFlag != null">
        #{tmpdata.checkFlag,jdbcType=VARCHAR},
      </if>
      <if test="tmpdata.errorFlag != null">
        #{tmpdata.errorFlag,jdbcType=CHAR},
      </if>
      <if test="tmpdata.isAudit != null">
        #{tmpdata.isAudit,jdbcType=CHAR},
      </if>
      <if test="tmpdata.selfDelete != null">
        #{tmpdata.selfDelete,jdbcType=CHAR},
      </if>
      <if test="tmpdata.memo != null">
        #{tmpdata.memo,jdbcType=VARCHAR},
      </if>
      <if test="tmpdata.processState != null">
        #{tmpdata.processState,jdbcType=VARCHAR},
      </if>
      <if test="tmpdata.recDate != null">
        #{tmpdata.recDate,jdbcType=CHAR},
      </if>
      <if test="tmpdata.recFailCause != null">
        #{tmpdata.recFailCause,jdbcType=VARCHAR},
      </if>
      <if test="tmpdata.flowId != null">
        #{tmpdata.flowId,jdbcType=VARCHAR},
      </if>
      <if test="tmpdata.imageSize != null">
        #{tmpdata.imageSize,jdbcType=DECIMAL},
      </if>
      <if test="tmpdata.backImageSize != null">
        #{tmpdata.backImageSize,jdbcType=DECIMAL},
      </if>
      <if test="tmpdata.patchFlag != null">
        #{tmpdata.patchFlag,jdbcType=DECIMAL},
      </if>
      <if test="tmpdata.fileName != null">
        #{tmpdata.fileName,jdbcType=VARCHAR},
      </if>
      <if test="tmpdata.backFileName != null">
        #{tmpdata.backFileName,jdbcType=VARCHAR},
      </if>
      <if test="tmpdata.ocrWorker != null">
        #{tmpdata.ocrWorker,jdbcType=VARCHAR},
      </if>
      <if test="tmpdata.ocrDate != null">
        #{tmpdata.ocrDate,jdbcType=CHAR},
      </if>
      <if test="tmpdata.ocrTime != null">
        #{tmpdata.ocrTime,jdbcType=CHAR},
      </if>
      <if test="tmpdata.copySerialno != null">
        #{tmpdata.copySerialno,jdbcType=VARCHAR},
      </if>
      <if test="tmpdata.isSign != null">
        #{tmpdata.isSign,jdbcType=CHAR},
      </if>
      <if test="tmpdata.superviseDeal != null">
        #{tmpdata.superviseDeal,jdbcType=CHAR},
      </if>
      <if test="tmpdata.contentId != null">
        #{tmpdata.contentId,jdbcType=VARCHAR},
      </if>
      <if test="tmpdata.dataSourceId != null">
        #{tmpdata.dataSourceId,jdbcType=VARCHAR},
      </if>
      <if test="tmpdata.voucherNumber != null">
        #{tmpdata.voucherNumber,jdbcType=DECIMAL},
      </if>
      <if test="tmpdata.formId != null">
        #{tmpdata.formId,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.sunyard.ars.common.pojo.TmpData">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update BP_TMPDATA_1_TB
    <set>
      <if test="batchId != null">
        BATCH_ID = #{batchId,jdbcType=CHAR},
      </if>
      <if test="inccodeinBatch != null">
        INCCODEIN_BATCH = #{inccodeinBatch,jdbcType=DECIMAL},
      </if>
      <if test="copyInccodein != null">
        COPY_INCCODEIN = #{copyInccodein,jdbcType=DECIMAL},
      </if>
      <if test="copyRec != null">
        COPY_REC = #{copyRec,jdbcType=DECIMAL},
      </if>
      <if test="isFrontPage != null">
        IS_FRONT_PAGE = #{isFrontPage,jdbcType=CHAR},
      </if>
      <if test="psLevel != null">
        PS_LEVEL = #{psLevel,jdbcType=CHAR},
      </if>
      <if test="primaryInccodein != null">
        PRIMARY_INCCODEIN = #{primaryInccodein,jdbcType=DECIMAL},
      </if>
      <if test="formName != null">
        FORM_NAME = #{formName,jdbcType=VARCHAR},
      </if>
      <if test="formGroup != null">
        FORM_GROUP = #{formGroup,jdbcType=VARCHAR},
      </if>
      <if test="vouhType != null">
        VOUH_TYPE = #{vouhType,jdbcType=VARCHAR},
      </if>
      <if test="checkFlag != null">
        CHECK_FLAG = #{checkFlag,jdbcType=VARCHAR},
      </if>
      <if test="errorFlag != null">
        ERROR_FLAG = #{errorFlag,jdbcType=CHAR},
      </if>
      <if test="isAudit != null">
        IS_AUDIT = #{isAudit,jdbcType=CHAR},
      </if>
      <if test="selfDelete != null">
        SELF_DELETE = #{selfDelete,jdbcType=CHAR},
      </if>
      <if test="memo != null">
        MEMO = #{memo,jdbcType=VARCHAR},
      </if>
      <if test="processState != null">
        PROCESS_STATE = #{processState,jdbcType=VARCHAR},
      </if>
      <if test="recDate != null">
        REC_DATE = #{recDate,jdbcType=CHAR},
      </if>
      <if test="recFailCause != null">
        REC_FAIL_CAUSE = #{recFailCause,jdbcType=VARCHAR},
      </if>
      <if test="flowId != null">
        FLOW_ID = #{flowId,jdbcType=VARCHAR},
      </if>
      <if test="imageSize != null">
        IMAGE_SIZE = #{imageSize,jdbcType=DECIMAL},
      </if>
      <if test="backImageSize != null">
        BACK_IMAGE_SIZE = #{backImageSize,jdbcType=DECIMAL},
      </if>
      <if test="patchFlag != null">
        PATCH_FLAG = #{patchFlag,jdbcType=DECIMAL},
      </if>
      <if test="fileName != null">
        FILE_NAME = #{fileName,jdbcType=VARCHAR},
      </if>
      <if test="backFileName != null">
        BACK_FILE_NAME = #{backFileName,jdbcType=VARCHAR},
      </if>
      <if test="ocrWorker != null">
        OCR_WORKER = #{ocrWorker,jdbcType=VARCHAR},
      </if>
      <if test="ocrDate != null">
        OCR_DATE = #{ocrDate,jdbcType=CHAR},
      </if>
      <if test="ocrTime != null">
        OCR_TIME = #{ocrTime,jdbcType=CHAR},
      </if>
      <if test="copySerialno != null">
        COPY_SERIALNO = #{copySerialno,jdbcType=VARCHAR},
      </if>
      <if test="isSign != null">
        IS_SIGN = #{isSign,jdbcType=CHAR},
      </if>
      <if test="superviseDeal != null">
        SUPERVISE_DEAL = #{superviseDeal,jdbcType=CHAR},
      </if>
      <if test="contentId != null">
        CONTENT_ID = #{contentId,jdbcType=VARCHAR},
      </if>
      <if test="dataSourceId != null">
        DATA_SOURCE_ID = #{dataSourceId,jdbcType=VARCHAR},
      </if>
      <if test="voucherNumber != null">
        VOUCHER_NUMBER = #{voucherNumber,jdbcType=DECIMAL},
      </if>
      <if test="formId != null">
        FORM_ID = #{formId,jdbcType=VARCHAR},
      </if>
    </set>
    where SERIAL_NO = #{serialNo,jdbcType=VARCHAR}
  </update>
  
  
  <select id="selectImageListByFlow" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  	SELECT T.SERIAL_NO,F.FLOW_ID,F.ACCOUNT,F.AMOUNT,T.INCCODEIN_BATCH,T.FORM_NAME FROM
      <if test="dataTb.indexOf('HIS') != -1  or dataTb.indexOf('his') != -1">
          FL_FLOW_TB_HIS F JOIN BP_TMPDATA_1_TB_HIS T
      </if>
      <if test="dataTb.indexOf('HIS') == -1 and dataTb.indexOf('his') == -1">
          FL_FLOW_TB F JOIN BP_TMPDATA_1_TB T
      </if>

       ON F.LSERIAL_NO = T.SERIAL_NO
	<where>
	   <if test="patchFlow !=null and patchFlow !=''">
	     AND F.FLOW_ID like  CONCAT(CONCAT('%',#{patchFlow}),'%')
	   </if>
	    AND  F.OPERATOR_NO =#{tmpbatch.operatorNo} AND F.SITE_NO =#{tmpbatch.siteNo} AND F.OCCUR_DATE=#{tmpbatch.occurDate} AND T.BATCH_ID =#{tmpbatch.batchId}
	</where>  
	ORDER BY F.FLOW_ID ASC
  </select> 
  
  <select id="selectDataList" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from
      <if test="dataTb.indexOf('HIS') != -1  or dataTb.indexOf('his') != -1">
           BP_TMPDATA_1_TB_HIS
      </if>
      <if test="dataTb.indexOf('HIS') == -1 and dataTb.indexOf('his') == -1">
           BP_TMPDATA_1_TB
      </if>
    where BATCH_ID = #{batchId,jdbcType=VARCHAR}
    order by INCCODEIN_BATCH
  </select>
  
  <update id="updateBeforeSubmit">
	UPDATE
      <if test="dataTb.indexOf('HIS') != -1  or dataTb.indexOf('his') != -1">
           BP_TMPDATA_1_TB_HIS T
      </if>
      <if test="dataTb.indexOf('HIS') == -1 and dataTb.indexOf('his') == -1">
           BP_TMPDATA_1_TB T
      </if>
	  SET T.COPY_SERIALNO =(
	SELECT T1.SERIAL_NO FROM
    <if test="dataTb.indexOf('HIS') != -1  or dataTb.indexOf('his') != -1">
      BP_TMPDATA_1_TB_HIS
    </if>
    <if test="dataTb.indexOf('HIS') == -1 and dataTb.indexOf('his') == -1">
      BP_TMPDATA_1_TB
    </if>

    T1 WHERE T1.INCCODEIN_BATCH =
	T.PRIMARY_INCCODEIN AND T1.BATCH_ID=#{batchId})
	WHERE T.PRIMARY_INCCODEIN <![CDATA[<>]]> 0 AND T.BATCH_ID=#{batchId}
  </update>
  
  <update id="updateTmpData" parameterType="java.util.HashMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update ${dataTb}
    <set>
      <if test="newBatchId != null">
        BATCH_ID = #{newBatchId,jdbcType=CHAR},
      </if>
      <if test="newInccodeinBatch != null">
        INCCODEIN_BATCH = #{newInccodeinBatch,jdbcType=DECIMAL},
      </if>
      <if test="newCopyInccodein != null">
        COPY_INCCODEIN = #{newCopyInccodein,jdbcType=DECIMAL},
      </if>
      <if test="newCopyRec != null">
        COPY_REC = #{newCopyRec,jdbcType=DECIMAL},
      </if>
      <if test="newIsFrontPage != null">
        IS_FRONT_PAGE = #{newIsFrontPage,jdbcType=CHAR},
      </if>
      <if test="newPsLevel != null">
        PS_LEVEL = #{newPsLevel,jdbcType=CHAR},
      </if>
      <if test="newPrimaryInccodein != null">
        PRIMARY_INCCODEIN = #{newPrimaryInccodein,jdbcType=DECIMAL},
      </if>
      <if test="newFormName != null">
        FORM_NAME = #{newFormName,jdbcType=VARCHAR},
      </if>
      <if test="newFormGroup != null">
        FORM_GROUP = #{newFormGroup,jdbcType=VARCHAR},
      </if>
      <if test="newVouhType != null">
        VOUH_TYPE = #{newVouhType,jdbcType=VARCHAR},
      </if>
      <if test="newCheckFlag != null">
        CHECK_FLAG = #{newCheckFlag,jdbcType=VARCHAR},
      </if>
      <if test="newErrorFlag != null">
        ERROR_FLAG = #{newErrorFlag,jdbcType=CHAR},
      </if>
      <if test="newIsAudit != null">
        IS_AUDIT = #{newIsAudit,jdbcType=CHAR},
      </if>
      <if test="newSelfDelete != null">
        SELF_DELETE = #{newSelfDelete,jdbcType=CHAR},
      </if>
      <if test="newMemo != null">
        MEMO = #{newMemo,jdbcType=VARCHAR},
      </if>
      <if test="newProcessState != null">
        PROCESS_STATE = #{newProcessState,jdbcType=VARCHAR},
      </if>
      <if test="newRecDate != null">
        REC_DATE = #{newRecDate,jdbcType=CHAR},
      </if>
      <if test="newRecFailCause != null">
        REC_FAIL_CAUSE = #{newRecFailCause,jdbcType=VARCHAR},
      </if>
      <if test="newFlowId != null">
        FLOW_ID = #{newFlowId,jdbcType=VARCHAR},
      </if>
      <if test="newImageSize != null">
        IMAGE_SIZE = #{newImageSize,jdbcType=DECIMAL},
      </if>
      <if test="newBackImageSize != null">
        BACK_IMAGE_SIZE = #{newBackImageSize,jdbcType=DECIMAL},
      </if>
      <if test="newPatchFlag != null">
        PATCH_FLAG = #{newPatchFlag,jdbcType=DECIMAL},
      </if>
      <if test="newFileName != null">
        FILE_NAME = #{newFileName,jdbcType=VARCHAR},
      </if>
      <if test="newBackFileName != null">
        BACK_FILE_NAME = #{newBackFileName,jdbcType=VARCHAR},
      </if>
      <if test="newOcrWorker != null">
        OCR_WORKER = #{newOcrWorker,jdbcType=VARCHAR},
      </if>
      <if test="newOcrDate != null">
        OCR_DATE = #{newOcrDate,jdbcType=CHAR},
      </if>
      <if test="newOcrTime != null">
        OCR_TIME = #{newOcrTime,jdbcType=CHAR},
      </if>
      <if test="newCopySerialno != null">
        COPY_SERIALNO = #{newCopySerialno,jdbcType=VARCHAR},
      </if>
      <if test="newIsSign != null">
        IS_SIGN = #{newIsSign,jdbcType=CHAR},
      </if>
      <if test="newSuperviseDeal != null">
        SUPERVISE_DEAL = #{newSuperviseDeal,jdbcType=CHAR},
      </if>
      <if test="newContentId != null">
        CONTENT_ID = #{newContentId,jdbcType=VARCHAR},
      </if>
      <if test="newDataSourceId != null">
        DATA_SOURCE_ID = #{newDataSourceId,jdbcType=VARCHAR},
      </if>
      <if test="newVoucherNumber != null">
        VOUCHER_NUMBER = #{newVoucherNumber,jdbcType=DECIMAL},
      </if>
      <if test="newFormId != null">
        FORM_ID = #{newFormId,jdbcType=VARCHAR},
      </if>
    </set>
    
    <where>
       SERIAL_NO = #{serialNo}
     <if test="batchId != null">
      AND  BATCH_ID = #{batchId,jdbcType=CHAR}
      </if>
      <if test="inccodeinBatch != null">
      AND  INCCODEIN_BATCH = #{inccodeinBatch,jdbcType=DECIMAL}
      </if>
      <if test="copyInccodein != null">
      AND  COPY_INCCODEIN = #{copyInccodein,jdbcType=DECIMAL}
      </if>
      <if test="copyRec != null">
       AND  COPY_REC = #{copyRec,jdbcType=DECIMAL}
      </if>
      <if test="isFrontPage != null">
       AND   IS_FRONT_PAGE = #{isFrontPage,jdbcType=CHAR}
      </if>
      <if test="psLevel != null">
        AND   PS_LEVEL = #{psLevel,jdbcType=CHAR}
      </if>
      <if test="primaryInccodein != null">
        AND   PRIMARY_INCCODEIN = #{primaryInccodein,jdbcType=DECIMAL}
      </if>
      <if test="formName != null">
       AND  FORM_NAME = #{formName,jdbcType=VARCHAR}
      </if>
      <if test="formGroup != null">
       AND FORM_GROUP = #{formGroup,jdbcType=VARCHAR}
      </if>
      <if test="vouhType != null">
       AND  VOUH_TYPE = #{vouhType,jdbcType=VARCHAR}
      </if>
      <if test="checkFlag != null">
       AND CHECK_FLAG = #{checkFlag,jdbcType=VARCHAR}
      </if>
      <if test="errorFlag != null">
       AND ERROR_FLAG = #{errorFlag,jdbcType=CHAR}
      </if>
      <if test="isAudit != null">
       AND IS_AUDIT = #{isAudit,jdbcType=CHAR}
      </if>
      <if test="selfDelete != null">
       AND SELF_DELETE = #{selfDelete,jdbcType=CHAR}
      </if>
      <if test="memo != null">
       AND MEMO = #{memo,jdbcType=VARCHAR}
      </if>
      <if test="processState != null">
       AND PROCESS_STATE = #{processState,jdbcType=VARCHAR}
      </if>
      <if test="recDate != null">
       AND  REC_DATE = #{recDate,jdbcType=CHAR}
      </if>
      <if test="recFailCause != null">
       AND REC_FAIL_CAUSE = #{recFailCause,jdbcType=VARCHAR}
      </if>
      <if test="flowId != null">
       AND FLOW_ID = #{flowId,jdbcType=VARCHAR}
      </if>
      <if test="imageSize != null">
       AND IMAGE_SIZE = #{imageSize,jdbcType=DECIMAL}
      </if>
      <if test="backImageSize != null">
       AND BACK_IMAGE_SIZE = #{backImageSize,jdbcType=DECIMAL}
      </if>
      <if test="patchFlag != null">
       AND PATCH_FLAG = #{patchFlag,jdbcType=DECIMAL}
      </if>
      <if test="fileName != null">
       AND FILE_NAME = #{fileName,jdbcType=VARCHAR}
      </if>
      <if test="backFileName != null">
       AND BACK_FILE_NAME = #{backFileName,jdbcType=VARCHAR}
      </if>
      <if test="ocrWorker != null">
       AND OCR_WORKER = #{ocrWorker,jdbcType=VARCHAR}
      </if>
      <if test="ocrDate != null">
       AND OCR_DATE = #{ocrDate,jdbcType=CHAR}
      </if>
      <if test="ocrTime != null">
       AND OCR_TIME = #{ocrTime,jdbcType=CHAR}
      </if>
      <if test="copySerialno != null">
       AND COPY_SERIALNO = #{copySerialno,jdbcType=VARCHAR}
      </if>
      <if test="isSign != null">
       AND IS_SIGN = #{isSign,jdbcType=CHAR}
      </if>
      <if test="superviseDeal != null">
       AND SUPERVISE_DEAL = #{superviseDeal,jdbcType=CHAR}
      </if>
      <if test="contentId != null">
       AND CONTENT_ID = #{contentId,jdbcType=VARCHAR}
      </if>
      <if test="dataSourceId != null">
       AND DATA_SOURCE_ID = #{dataSourceId,jdbcType=VARCHAR}
      </if>
      <if test="voucherNumber != null">
       AND VOUCHER_NUMBER = #{voucherNumber,jdbcType=DECIMAL}
      </if>
      <if test="formId != null">
       AND FORM_ID = #{formId,jdbcType=VARCHAR}
      </if>
    
    </where>

  </update>
  
  <update id="updateCopyInccodein">
  UPDATE
      <if test="dataTb.indexOf('HIS') != -1  or dataTb.indexOf('his') != -1">
          BP_TMPDATA_1_TB_HIS
      </if>
      <if test="dataTb.indexOf('HIS') == -1 and dataTb.indexOf('his') == -1">
          BP_TMPDATA_1_TB
      </if>
    T SET T.COPY_INCCODEIN = #{inccodeinBatch} WHERE T.SERIAL_NO IN
  
  <foreach collection="serialNos" index="index" item="item" open="(" separator="," close=")">
  #{item}
  </foreach>
   AND T.BATCH_ID=#{batchId}
  </update>
  
  <update id="updateCopyInccodeinbatch">
	UPDATE
      <if test="dataTb.indexOf('HIS') != -1  or dataTb.indexOf('his') != -1">
          BP_TMPDATA_1_TB_HIS
      </if>
      <if test="dataTb.indexOf('HIS') == -1 and dataTb.indexOf('his') == -1">
          BP_TMPDATA_1_TB
      </if>
	 T SET T.INCCODEIN_BATCH = (SELECT COUNT(1) +
	#{copyCount} FROM
    <if test="dataTb.indexOf('HIS') != -1  or dataTb.indexOf('his') != -1">
      BP_TMPDATA_1_TB_HIS
      </if>
    <if test="dataTb.indexOf('HIS') == -1 and dataTb.indexOf('his') == -1">
      BP_TMPDATA_1_TB
    </if>
    T1 WHERE T1.COPY_INCCODEIN = 0 AND
	T1.BATCH_ID = #{batchId}) WHERE T.SERIAL_NO=#{serialNo} AND
	T.BATCH_ID=#{batchId}
  </update>
  
  <update id="updatePrimary">
	UPDATE
      <if test="dataTb.indexOf('HIS') != -1  or dataTb.indexOf('his') != -1">
          BP_TMPDATA_1_TB_HIS
      </if>
      <if test="dataTb.indexOf('HIS') == -1 and dataTb.indexOf('his') == -1">
          BP_TMPDATA_1_TB
      </if>
	 T SET T.PRIMARY_INCCODEIN =(SELECT T1.INCCODEIN_BATCH
	FROM
      <if test="dataTb.indexOf('HIS') != -1  or dataTb.indexOf('his') != -1">
          BP_TMPDATA_1_TB_HIS
      </if>
      <if test="dataTb.indexOf('HIS') == -1 and dataTb.indexOf('his') == -1">
          BP_TMPDATA_1_TB
      </if>
    T1 WHERE T1.SERIAL_NO = T.COPY_SERIALNO AND
	T1.BATCH_ID=#{batchId})
	WHERE T.PRIMARY_INCCODEIN <![CDATA[<>]]> 0 AND T.BATCH_ID=#{batchId}
  </update>
  
  <update id="updateCopySerialNo">
 	UPDATE
    <if test="dataTb.indexOf('HIS') != -1  or dataTb.indexOf('his') != -1">
      BP_TMPDATA_1_TB_HIS
    </if>
    <if test="dataTb.indexOf('HIS') == -1 and dataTb.indexOf('his') == -1">
      BP_TMPDATA_1_TB
    </if>

 	 T SET T.COPY_SERIALNO = '' WHERE T.BATCH_ID=#{batchId}
  </update>
  
  <update id="updateProcessState">
  		update
      <if test="dataTb.indexOf('HIS') != -1  or dataTb.indexOf('his') != -1">
          BP_TMPDATA_1_TB_HIS
      </if>
      <if test="dataTb.indexOf('HIS') == -1 and dataTb.indexOf('his') == -1">
          BP_TMPDATA_1_TB
      </if>
  		 set PROCESS_STATE=substr(PROCESS_STATE,1,3)||'0'||substr(PROCESS_STATE,5) where batch_id=#{batchId} and substr(PROCESS_STATE,4,1)='1'
  </update>
  

  <select id="selectPatchImageList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  select SERIAL_NO, INCCODEIN_BATCH, FILE_NAME, BACK_FILE_NAME, OCR_WORKER from
      <if test="dataTb.indexOf('HIS') != -1  or dataTb.indexOf('his') != -1">
          BP_TMPDATA_1_TB_HIS
      </if>
      <if test="dataTb.indexOf('HIS') == -1 and dataTb.indexOf('his') == -1">
          BP_TMPDATA_1_TB
      </if>
   where batch_id=#{batchId} and substr(PROCESS_STATE,4,1)='1' order by inccodein_batch
  
  </select>
  
  <select id="selectPatchTaskImageList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  	select * from BP_PATCHTASK_TB where batch_id=#{batchId}
  </select>

 <select id="getPatchVoucCount"  resultType="java.lang.Integer" >
  	select count(*) from BP_TMPDATA_1_TB
  		<where>
   			BATCH_ID in 
   			<foreach collection="list" open="(" close=")" item="id" separator=",">
   				#{id}
   			</foreach>
   		and substr(PROCESS_STATE,4,1)='1' order by inccodein_batch
   		</where> 
 </select>
 
   <select id="getPatchTaskCount"   resultType="java.lang.Integer">
  	select count(*) from BP_PATCHTASK_TB 
  			<where>
   			BATCH_ID in 
   			<foreach collection="list" open="(" close=")" item="id" separator=",">
   				#{id}
   			</foreach>
   		</where>
  </select>
	

<!--根据传入条件获取图像数量数量-->
  <select id="selectImgCount" parameterType="java.util.HashMap" resultType="java.lang.Integer">
	SELECT COUNT(1) FROM bp_tmpdata_1_tb  
    <where>
    	<if test="selfDelete != null">
	        AND SELF_DELETE = #{selfDelete,jdbcType=CHAR}
	    </if>
    	<if test="checkFlag != null">
	        AND CHECK_FLAG = #{checkFlag,jdbcType=VARCHAR}
	    </if>
	    <if test="batchId != null">
	        AND BATCH_ID = #{batchId,jdbcType=VARCHAR}
	    </if>
	    <if test="serialNo != null">
	        AND SERIAL_NO = #{serialNo,jdbcType=VARCHAR}
	    </if>
    </where>
  </select>
  
  <!--根据serialNo修改图像信息-->
  <update id="updateTmpDataInfo" parameterType="java.util.HashMap">
    update BP_TMPDATA_1_TB
    <set>
      <if test="copyInccodein != null">
        COPY_INCCODEIN = #{copyInccodein,jdbcType=DECIMAL},
      </if>
      <if test="psLevel != null">
        PS_LEVEL = #{psLevel,jdbcType=CHAR},
      </if>
      <if test="primaryInccodein != null">
        PRIMARY_INCCODEIN = #{primaryInccodein,jdbcType=DECIMAL},
      </if>
      <if test="formName != null">
        FORM_NAME = #{formName,jdbcType=VARCHAR},
      </if>
      <if test="formName != null">
        FORM_GROUP = (SELECT FORM_ID FROM SM_FORM_INFO_TB WHERE FORM_NAME = #{formName,jdbcType=VARCHAR}),
      </if>
      <if test="checkFlag != null">
        CHECK_FLAG = #{checkFlag,jdbcType=VARCHAR},
      </if>
      <if test="errorFlag != null">
        ERROR_FLAG = #{errorFlag,jdbcType=CHAR},
      </if>
      <if test="isAudit != null">
        IS_AUDIT = #{isAudit,jdbcType=CHAR},
      </if>
      <if test="selfDelete != null">
        SELF_DELETE = #{selfDelete,jdbcType=CHAR},
      </if>
      <if test="processState != null">
      	<choose>
      		<when test='processState == "1"'><!--人工处理位更新为1-->
      			PROCESS_STATE =  (SELECT SUBSTR(PROCESS_STATE, 1, 1) || '1' || SUBSTR(PROCESS_STATE, 3,4) FROM bp_tmpdata_1_tb WHERE SERIAL_NO = #{serialNo,jdbcType=VARCHAR}),
      		</when>
      		<when test='processState == "2"'><!--业务审核位强过更新为1-->
      			PROCESS_STATE =  (SELECT SUBSTR(PROCESS_STATE, 1, 2) || '1' || SUBSTR(PROCESS_STATE, 4,3) FROM bp_tmpdata_1_tb WHERE SERIAL_NO = #{serialNo,jdbcType=VARCHAR}),
      		</when>
      		<when test='processState == "5"'><!--业务审核位撤销强过更新为1-->
      			PROCESS_STATE =  (SELECT SUBSTR(PROCESS_STATE, 1, 2) || '0' || SUBSTR(PROCESS_STATE, 4,3) FROM bp_tmpdata_1_tb WHERE SERIAL_NO = #{serialNo,jdbcType=VARCHAR}),
      		</when>
      		<when test='processState == "3"'><!--标记重扫位更新为0-->
      			PROCESS_STATE =  (SELECT SUBSTR(PROCESS_STATE, 1, 3) || '0' || SUBSTR(PROCESS_STATE, 5,2) FROM bp_tmpdata_1_tb WHERE SERIAL_NO = #{serialNo,jdbcType=VARCHAR}),
      		</when>
      		<when test='processState == "4"'><!--标记重扫位更新为1-->
      			PROCESS_STATE =  (SELECT SUBSTR(PROCESS_STATE, 1, 3) || '1' || SUBSTR(PROCESS_STATE, 5,2) FROM bp_tmpdata_1_tb WHERE SERIAL_NO = #{serialNo,jdbcType=VARCHAR}),
      		</when>
      	</choose>
      </if>
      <if test="flowId != null">
        FLOW_ID = #{flowId,jdbcType=VARCHAR},
      </if>
      <if test="patchFlag != null">
        PATCH_FLAG = #{patchFlag,jdbcType=DECIMAL},
      </if>
      <if test="ocrWorker != null">
        OCR_WORKER = #{ocrWorker,jdbcType=VARCHAR},
      </if>
      <if test="ocrDate != null">
        OCR_DATE = #{ocrDate,jdbcType=CHAR},
      </if>
      <if test="ocrTime != null">
        OCR_TIME = #{ocrTime,jdbcType=CHAR},
      </if>
    </set>
    where SERIAL_NO = #{serialNo,jdbcType=VARCHAR}
  </update>
  
  <select id="selectBySelective" parameterType="java.util.HashMap" resultType="java.util.HashMap">
    select PRIMARY_INCCODEIN
    from BP_TMPDATA_1_TB
    where PS_LEVEL = #{psLevel,jdbcType=CHAR} and SERIAL_NO = #{serialNo,jdbcType=VARCHAR}
  </select>
  
  <!--设主件更新其后面附件sql语句-->
  <update id="updatePsLevelUp" parameterType="java.util.HashMap">
    update BP_TMPDATA_1_TB
    <set>
      <if test="primaryInccodein != null">
        PRIMARY_INCCODEIN = #{inccodeinBatch,jdbcType=DECIMAL},
      </if>
      <if test="checkFlag != null">
        CHECK_FLAG = #{checkFlag,jdbcType=VARCHAR},
      </if>
      <if test="processState != null">
      	<choose>
      		<when test='processState == "1"'><!--人工处理位更新为1-->
      			PROCESS_STATE =  (SELECT SUBSTR(PROCESS_STATE, 1, 1) || '1' || SUBSTR(PROCESS_STATE, 3,4) FROM bp_tmpdata_1_tb WHERE SERIAL_NO = #{serialNo,jdbcType=VARCHAR}),
      		</when>
      		<when test='processState == "2"'><!--业务审核位更新为1-->
      			PROCESS_STATE =  (SELECT SUBSTR(PROCESS_STATE, 1, 2) || '1' || SUBSTR(PROCESS_STATE, 4,3) FROM bp_tmpdata_1_tb WHERE SERIAL_NO = #{serialNo,jdbcType=VARCHAR}),
      		</when>
      	</choose>
      </if>
      <if test="flowId != null">
        FLOW_ID = #{flowId,jdbcType=VARCHAR},
      </if>
    </set>
    where SERIAL_NO in (SELECT serial_no FROM bp_tmpdata_1_tb WHERE PRIMARY_INCCODEIN = #{primaryInccodein,jdbcType=DECIMAL} AND INCCODEIN_BATCH > #{inccodeinBatch,jdbcType=DECIMAL} AND PS_LEVEL = '0' AND BATCH_ID = #{batchId,jdbcType=VARCHAR})
  </update>
  
  <!--复制影像插入方法-->
  <insert id="insertCopyImage" parameterType="java.util.HashMap">
    insert into BP_TMPDATA_1_TB(SERIAL_NO,BATCH_ID,INCCODEIN_BATCH,COPY_INCCODEIN,IS_FRONT_PAGE,
        PS_LEVEL,FORM_NAME,FORM_GROUP,CHECK_FLAG,PROCESS_STATE,FILE_NAME,BACK_FILE_NAME,IS_SIGN)
    SELECT #{copySerialNo,jdbcType=VARCHAR},BATCH_ID,(SELECT MAX(INCCODEIN_BATCH) + 1 FROM BP_TMPDATA_1_TB BP1 WHERE BP1.BATCH_ID = BP.BATCH_ID),#{inccodeinBatch,jdbcType=DECIMAL},IS_FRONT_PAGE,PS_LEVEL,
    FORM_NAME,FORM_GROUP,'-1','000000',FILE_NAME,BACK_FILE_NAME,IS_SIGN FROM BP_TMPDATA_1_TB BP WHERE SERIAL_NO = #{serialNo,jdbcType=VARCHAR}
  </insert>
  
  <!--手工指定主件方法-->
  <update id="updateHandleUp" parameterType="java.util.HashMap">
    update BP_TMPDATA_1_TB
    <set>
      <if test="inccodeinBatch != null">
        PRIMARY_INCCODEIN = #{inccodeinBatch,jdbcType=DECIMAL},
      </if>
      <if test="processState != null">
      	<choose>
      		<when test='processState == "1"'><!--人工处理位更新为1-->
      			PROCESS_STATE =  (SELECT SUBSTR(PROCESS_STATE, 1, 1) || '1' || SUBSTR(PROCESS_STATE, 3,4) FROM bp_tmpdata_1_tb WHERE SERIAL_NO = #{serialNo,jdbcType=VARCHAR}),
      		</when>
      		<when test='processState == "2"'><!--业务审核位更新为1-->
      			PROCESS_STATE =  (SELECT SUBSTR(PROCESS_STATE, 1, 2) || '1' || SUBSTR(PROCESS_STATE, 4,3) FROM bp_tmpdata_1_tb WHERE SERIAL_NO = #{serialNo,jdbcType=VARCHAR}),
      		</when>
      	</choose>
      </if>
    </set>
    where SERIAL_NO = #{serialNo,jdbcType=VARCHAR}
    AND EXISTS (SELECT 1 FROM BP_TMPDATA_1_TB WHERE PS_LEVEL = '1' AND SELF_DELETE = '0' AND INCCODEIN_BATCH = #{inccodeinBatch,jdbcType=DECIMAL} AND BATCH_ID = #{batchId,jdbcType=CHAR}) 
  </update>
  
  <!--设附件更新sql语句-->
  <update id="updatePsLevelDownAll" parameterType="java.util.HashMap">
    update BP_TMPDATA_1_TB
    <set>
      PS_LEVEL = '0', CHECK_FLAG = '0', PRIMARY_INCCODEIN = 0,FLOW_ID = '',
      <if test="processState != null">
      	<choose>
      		<when test='processState == "1"'><!--人工处理位更新为1-->
      			PROCESS_STATE =  (SELECT SUBSTR(PROCESS_STATE, 1, 1) || '1' || SUBSTR(PROCESS_STATE, 3,4) FROM bp_tmpdata_1_tb WHERE SERIAL_NO = #{serialNo,jdbcType=VARCHAR}),
      		</when>
      		<when test='processState == "2"'><!--业务审核位更新为1-->
      			PROCESS_STATE =  (SELECT SUBSTR(PROCESS_STATE, 1, 2) || '1' || SUBSTR(PROCESS_STATE, 4,3) FROM bp_tmpdata_1_tb WHERE SERIAL_NO = #{serialNo,jdbcType=VARCHAR}),
      		</when>
      	</choose>
      </if>
      <if test="ocrWorker != null">
        OCR_WORKER = #{ocrWorker,jdbcType=VARCHAR},
      </if>
      <if test="ocrDate != null">
        OCR_DATE = #{ocrDate,jdbcType=CHAR},
      </if>
      <if test="ocrTime != null">
        OCR_TIME = #{ocrTime,jdbcType=CHAR},
      </if>
    </set>
    where (SERIAL_NO = #{serialNo,jdbcType=VARCHAR} OR PRIMARY_INCCODEIN = #{inccodeinBatch,jdbcType=DECIMAL}) AND BATCH_ID = #{batchId,jdbcType=VARCHAR}
  </update>
  
  <!--释放所有勾兑图像-->
  <update id="updateAllTmpData" parameterType="java.util.HashMap">
    update BP_TMPDATA_1_TB 
    <set>
    	  CHECK_FLAG = '-1',FLOW_ID = '',
	      <if test="ocrWorker != null">
	        OCR_WORKER = #{ocrWorker,jdbcType=VARCHAR},
	      </if>
	      <if test="ocrDate != null">
	        OCR_DATE = #{ocrDate,jdbcType=CHAR},
	      </if>
	      <if test="ocrTime != null">
	        OCR_TIME = #{ocrTime,jdbcType=CHAR},
	      </if>
	      <if test="newPsLevel != null">
	        PS_LEVEL = #{newPsLevel,jdbcType=CHAR},
	      </if>
	      <if test="newPrimaryInccodein != null">
	        PRIMARY_INCCODEIN = #{newPrimaryInccodein,jdbcType=DECIMAL},
	      </if>
	      <if test="newFormName != null">
	        FORM_NAME = #{newFormName,jdbcType=VARCHAR},
	      </if>
          <if test="newFormId != null">
             FORM_ID = #{newFormId,jdbcType=VARCHAR},
          </if>
	      <if test="newFormGroup != null">
	        FORM_GROUP = #{newFormGroup,jdbcType=VARCHAR},
	      </if>
	      <if test="newIsAudit != null">
	        IS_AUDIT = #{newIsAudit,jdbcType=CHAR},
	      </if>
	      <if test="newProcessState != null">
	        PROCESS_STATE = #{newProcessState,jdbcType=VARCHAR},
	      </if>
	      <if test="newRecDate != null">
	        REC_DATE = #{newRecDate,jdbcType=CHAR},
	      </if>
	      <if test="newRecFailCause != null">
	        REC_FAIL_CAUSE = #{newRecFailCause,jdbcType=VARCHAR},
	      </if>
    </set>
    <where>
    	 <if test="oldCheckFlag != null and oldCheckFlag != ''">
		 	AND CHECK_FLAG = #{oldCheckFlag,jdbcType=VARCHAR}
		 </if>
		 <if test="batchId != ''">
		 	 AND BATCH_ID=#{batchId,jdbcType=VARCHAR}
		 </if>
    </where>
  </update>
  
  <select id="selectImageList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
   select 
    SERIAL_NO, BATCH_ID, INCCODEIN_BATCH, COPY_INCCODEIN, COPY_REC, IS_FRONT_PAGE, PS_LEVEL, 
    PRIMARY_INCCODEIN, FORM_NAME, FORM_GROUP, VOUH_TYPE, CHECK_FLAG, ERROR_FLAG, IS_AUDIT, 
    SELF_DELETE, MEMO, PROCESS_STATE, REC_DATE, REC_FAIL_CAUSE, FLOW_ID, IMAGE_SIZE, 
    BACK_IMAGE_SIZE, PATCH_FLAG, FILE_NAME, BACK_FILE_NAME, OCR_WORKER, OCR_DATE, OCR_TIME, 
    COPY_SERIALNO, IS_SIGN, SUPERVISE_DEAL, CONTENT_ID, DATA_SOURCE_ID, VOUCHER_NUMBER, 
    FORM_ID,B.INPUT_DATE
    from
      <if test="dataTb.indexOf('HIS') != -1  or dataTb.indexOf('his') != -1">
          BP_TMPDATA_1_TB_HIS
      </if>
      <if test="dataTb.indexOf('HIS') == -1 and dataTb.indexOf('his') == -1">
          BP_TMPDATA_1_TB
      </if>
    where T.BATCH_ID = #{batchId,jdbcType=VARCHAR}
    order by INCCODEIN_BATCH
  </select>
  
    <select id="selectImageListByBatchList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
    select 
    SERIAL_NO, T.BATCH_ID, INCCODEIN_BATCH, COPY_INCCODEIN, COPY_REC, IS_FRONT_PAGE, PS_LEVEL, 
    PRIMARY_INCCODEIN, FORM_NAME, FORM_GROUP, VOUH_TYPE, CHECK_FLAG, ERROR_FLAG, IS_AUDIT, 
    SELF_DELETE, MEMO, PROCESS_STATE, REC_DATE, REC_FAIL_CAUSE, FLOW_ID, IMAGE_SIZE, 
    BACK_IMAGE_SIZE, PATCH_FLAG, FILE_NAME, BACK_FILE_NAME, OCR_WORKER, OCR_DATE, OCR_TIME, 
    COPY_SERIALNO, IS_SIGN, SUPERVISE_DEAL, DATA_SOURCE_ID, VOUCHER_NUMBER, 
    FORM_ID,B.INPUT_DATE,B.CONTENT_ID
    from
        <if test="dataTb.indexOf('HIS') != -1  or dataTb.indexOf('his') != -1">
            BP_TMPDATA_1_TB_HIS
        </if>
        <if test="dataTb.indexOf('HIS') == -1 and dataTb.indexOf('his') == -1">
            BP_TMPDATA_1_TB
        </if>
      T JOIN BP_TMPBATCH_TB  B ON B.BATCH_ID = T.BATCH_ID
    where  T.BATCH_ID IN
		<foreach collection="batchList" item="batchId" open="(" separator="," close=")">
			#{batchId}
		</foreach>
		<if test="formName != null and formName != ''">
		  AND T.FORM_NAME=#{formName,jdbcType=VARCHAR}
    	</if>
    	<if test="imageList != null">
    		AND T.CHECK_FLAG IN
    		<foreach collection="imageList" item="imCheckFlag" open="(" separator="," close=")">
		        #{imCheckFlag}
			</foreach>
    	</if>
		AND B.PROGRESS_FLAG >= '98' order by INCCODEIN_BATCH
  </select>
  
  <select id="selectImageByNoFlow" parameterType="java.util.HashMap" resultType="java.util.HashMap">
    select E.* from (
    <foreach collection="dataTableList" index="index" item="dataTable" open="" separator="union" close="">
 	SELECT B.SERIAL_NO,B.SELF_DELETE,B.COPY_INCCODEIN,B.PATCH_FLAG,
      <if test="dataTable.indexOf('HIS') != -1">
        'BP_TMPDATA_1_TB_HIS'
      </if>
      <if test="dataTable.indexOf('HIS') == -1">
        'BP_TMPDATA_1_TB'
      </if>

       DATA_TB,B.CHECK_FLAG,B.ERROR_FLAG,
    B.BACK_FILE_NAME,B.FILE_NAME,B.FORM_NAME,B.INCCODEIN_BATCH,B.BATCH_ID, A.SITE_NO,A.OCCUR_DATE,A.OPERATOR_NO,B.FLOW_ID,A.INPUT_DATE,A.CONTENT_ID
    FROM
      <if test="dataTable.indexOf('HIS') != -1">
        BP_TMPDATA_1_TB_HIS
      </if>
      <if test="dataTable.indexOf('HIS') == -1">
        BP_TMPDATA_1_TB
      </if>

       B join BP_TMPBATCH_TB A on B.BATCH_ID = A.BATCH_ID
	<where>
		 AND B.SELF_DELETE = '0' AND B.PS_LEVEL = '1'
		<if test="form_name != ''">
		 	 AND B.FORM_NAME =#{form_name,jdbcType=VARCHAR}
		 </if>
		 <if test="businessId != ''">
		 	 AND A.BUSINESS_ID =#{businessId,jdbcType=DECIMAL}
		 </if>
		 <if test="needProcess != ''">
		 	 AND A.NEED_PROCESS =#{needProcess,jdbcType=VARCHAR}
		 </if>
		 AND A.IS_INVALID = '1'
		 <if test="operatorNo != ''">
		 	 AND A.OPERATOR_NO =#{operatorNo,jdbcType=VARCHAR}
		 </if>
		 <if test="siteNo != ''">
		 	 AND A.SITE_NO = #{siteNo,jdbcType=VARCHAR}
		 </if>
		 <if test="startDate != ''">
		 	 AND A.OCCUR_DATE &gt;= #{startDate,jdbcType=VARCHAR}
		 </if>
		 <if test="endDate != ''">
		 	 AND A.OCCUR_DATE &lt;= #{endDate,jdbcType=VARCHAR}
		 </if>
	</where>
    </foreach>
	) E ORDER BY E.OCCUR_DATE,E.OPERATOR_NO,E.BATCH_ID,E.INCCODEIN_BATCH
  </select>
  
  <select id="selectImageByFlow" parameterType="java.util.HashMap" resultType="java.util.HashMap">
    select E.* from (
    <foreach collection="dataTableList" index="index" item="dataTable" open="" separator="union" close="">
 	SELECT B.SERIAL_NO,B.SELF_DELETE,B.COPY_INCCODEIN,B.PATCH_FLAG,
      <if test="dataTable.indexOf('HIS') != -1">
          'BP_TMPDATA_1_TB_HIS'
        </if>
      <if test="dataTable.indexOf('HIS') == -1">
        'BP_TMPDATA_1_TB'
      </if>
      DATA_TB,B.CHECK_FLAG,B.ERROR_FLAG,
    B.BACK_FILE_NAME,B.FILE_NAME,B.FORM_NAME,B.INCCODEIN_BATCH,B.BATCH_ID, A.SITE_NO,A.OCCUR_DATE,A.OPERATOR_NO,B.FLOW_ID,A.INPUT_DATE,A.CONTENT_ID
    FROM
      <if test="dataTable.indexOf('HIS') != -1">
        BP_TMPDATA_1_TB_HIS
      </if>
      <if test="dataTable.indexOf('HIS') == -1">
        BP_TMPDATA_1_TB
      </if>
       B join BP_TMPBATCH_TB A on B.BATCH_ID = A.BATCH_ID
	<where>
		 AND B.SELF_DELETE = '0' AND B.PS_LEVEL = '1'  AND A.IS_INVALID = '1'
		 <if test="form_name != null and form_name != ''">
		 	 AND B.FORM_NAME =#{form_name,jdbcType=VARCHAR}
		 </if>
		 <if test="businessId != null and businessId != ''">
		 	 AND A.BUSINESS_ID =#{businessId,jdbcType=DECIMAL}
		 </if>
		 <if test="needProcess != null and needProcess != ''">
		 	 AND A.NEED_PROCESS =#{needProcess,jdbcType=VARCHAR}
		 </if>
		 AND A.IS_INVALID = '1'
		 <if test="operatorNo != null and operatorNo != ''">
		 	 AND A.OPERATOR_NO =#{operatorNo,jdbcType=VARCHAR}
		 </if>
		 <if test="siteNo != null and siteNo != ''">
		 	 AND A.SITE_NO =#{siteNo,jdbcType=VARCHAR}
		 </if>
		 <if test="startDate != null and startDate != ''">
		 	 AND A.OCCUR_DATE &gt;=#{startDate,jdbcType=VARCHAR}
		 </if>
		 <if test="endDate != null and endDate != ''">
		 	 AND A.OCCUR_DATE &lt;=#{endDate,jdbcType=VARCHAR}
		 </if>
		 and exists (select 1 from 
		 <if test="dataTable.indexOf('HIS') != -1">
		 	FL_FLOW_TB_HIS
		 </if>
		 <if test="dataTable.indexOf('HIS') == -1">
           FL_FLOW_TB
		 </if>
		  f where f.lserial_no = b.serial_no 
		  <if test="currency_type != null and currency_type != ''">
		 	 and f.CURRENCY_TYPE =#{currency_type,jdbcType=VARCHAR}
		 </if>
		 <if test="acctNo != null and acctNo != ''">
		 	 and f.ACCOUNT =#{acctNo,jdbcType=VARCHAR}
		 </if>
		 <if test="vouhNo != null and vouhNo != ''">
		 	 and f.VOUH_NO =#{vouhNo,jdbcType=VARCHAR}
		 </if>
		 <if test="subject_no != null and subject_no != ''">
		 	 and f.SUBJECT_NO =#{subject_no,jdbcType=VARCHAR}
		 </if>
		 <if test="tx_code != null and tx_code != ''">
		 	 and f.TX_CODE =#{tx_code,jdbcType=VARCHAR}
		 </if>
		 <if test="amountS != null and amountS != ''">
		 	 and f.AMOUNT &gt;=#{amountS,jdbcType=DECIMAL}
		 </if>
		 <if test="amountE != null and amountE != ''">
		 	 and f.AMOUNT &lt;=#{amountE,jdbcType=DECIMAL}
		 </if>
		 <if test="flow_id != null and flow_id != ''">
		 	 and f.FLOW_ID =#{flow_id,jdbcType=VARCHAR}
		 </if>
		  )
	</where>
    </foreach>
	) E ORDER BY E.OCCUR_DATE,E.OPERATOR_NO,E.BATCH_ID,E.INCCODEIN_BATCH
  </select>
  
   <select id="selectPadImageByMap" parameterType="java.util.HashMap" resultType="java.util.HashMap">
<!--
   	   SELECT T.SHEAD_TRSORGAN SITE_NO,T.SHEAD_TLRID OPERATOR_NO,T.SHEAD_TRSDT OCCUR_DATE,T.SHEAD_FLWNO FLOW_ID
       ,'' FORM_NAME,'' SERIAL_NO,'' BATCH_ID,'' INCCODEIN_BATCH,'' SELF_DELETE,'' CHECK_FLAG
       ,'' PATCH_FLAG,'' INPUT_DATE ,'2' SINO_TAG
       FROM PAD T 
      <where>
		 <if test="flowId != ''">
		 	 AND T.SHEAD_FLWNO =#{flowId,jdbcType=VARCHAR}
		 </if>
		 <if test="occurDate != ''">
		 	 AND T.SHEAD_TRSDT =#{occurDate,jdbcType=VARCHAR}
		 </if>
		  <if test="acctNo != ''">
		 	 and T.SBODY_ACCTNO =#{acctNo,jdbcType=VARCHAR}
		 </if>
		 <if test="amountS != ''">
		 	 and T.SBODY_AMT &gt;=#{amountS,jdbcType=DECIMAL}
		 </if>
		 <if test="amountE != ''">
		 	 and T.SBODY_AMT &lt;=#{amountE,jdbcType=DECIMAL}
		 </if>
	  </where>  
         ORDER BY T.SHEAD_TRSDT,T.SHEAD_TRSORGAN,T.SHEAD_TLRID
-->
      SELECT T.BUSI_TRSORGAN SITE_NO,T.BUSI_TLRID OPERATOR_NO,T.BUSI_TRSDT OCCUR_DATE,T.BUSI_FLWNO FLOW_ID
        ,'' FORM_NAME,T.BUSI_TYPE TRANS_TYPES ,'' PAYEE_ACCOUNT,T.BUSI_ACCTNO PAY_ACCOUNT,T.BUSI_AMT TRANS_AMOUNT
        ,'' KERNEL_NO,'' PATCH_FLAG ,PF.FILENO FILENO, PF.YSYID YSY_ID ,'2' SINO_TAG 
      FROM PAD_INFOLIST T LEFT JOIN PAD_FILELIST PF ON PF.FLWNO=T.BUSI_FLWNO  
      <where>
		 <if test="flowId != ''">
		 	 AND T.BUSI_FLWNO =#{flowId,jdbcType=VARCHAR}
		 </if>
		 <if test="occurDate != ''">
		 	 AND T.BUSI_TRSDT =#{occurDate,jdbcType=VARCHAR}
		 </if>
	  </where> 
       ORDER BY T.BUSI_TRSDT,T.BUSI_FLWNO
  </select>
  
   <select id="selectSinoImageByMap" parameterType="java.util.HashMap" resultType="java.util.HashMap">
<!--     	SELECT T.LANUCH_BRANCHNO SITE_NO,T.LAUNCH_TELLERID OPERATOR_NO,T.TRANS_DATE OCCUR_DATE,T.JOURNAL_NO FLOW_ID,'' FORM_NAME,T.TRANS_TYPES TRANS_TYPES  -->
<!--         ,T.PAYEE_ACCOUNT PAYEE_ACCOUNT,T.PAY_ACCOUNT PAY_ACCOUNT,T.TRANS_AMOUNT TRANS_AMOUNT,T.KERNEL_NO KERNEL_NO,'' PATCH_FLAG,T.DOC_ID BATCH_ID,T.TRANS_NAME TRANS_NAME,'1' SINO_TAG -->
<!--         FROM BIZ_TRANSLIST T  -->

		SELECT T.LANUCH_BRANCHNO SITE_NO,T.LAUNCH_TELLERID OPERATOR_NO,T.TRANS_DATE OCCUR_DATE
		,DECODE(T.DATA_SOURCE,2,SUBSTR(T.JOURNAL_NO,19,7),T.JOURNAL_NO) FLOW_ID,T.TRANS_NAME as FORM_NAME,T.TRANS_TYPES TRANS_TYPES 
        ,T.PAYEE_ACCOUNT PAYEE_ACCOUNT,T.PAY_ACCOUNT PAY_ACCOUNT,T.TRANS_AMOUNT TRANS_AMOUNT
        ,T.KERNEL_NO KERNEL_NO,'' PATCH_FLAG,T.DOC_ID BATCH_ID,T.TRANS_NAME TRANS_NAME,T.TRANS_CODE TRANS_CODE,'1' SINO_TAG
        FROM BIZ_TRANSLIST T 
      <where>
             T.ARCHIVE_STATE='0' 
		 <if test="flowId != ''">
		 	 AND DECODE(T.DATA_SOURCE,2,SUBSTR(T.JOURNAL_NO,19,7),T.JOURNAL_NO)=#{flowId,jdbcType=VARCHAR}
		 </if>
		 <if test="occurDate != ''">
		 	 AND T.TRANS_DATE =#{occurDate,jdbcType=VARCHAR}
		 </if>
		 <if test="siteNo != ''">
		 	 AND T.LANUCH_BRANCHNO =#{siteNo,jdbcType=VARCHAR}
		 </if>
		 <if test="operatorNo != ''">
		 	 AND T.LAUNCH_TELLERID =#{operatorNo,jdbcType=VARCHAR}
		 </if>
		  <if test="acctNo != ''">
		 	 and T.PAY_ACCOUNT =#{acctNo,jdbcType=VARCHAR}
		 </if>
		 <if test="amountS != ''">
		 	 and T.TRANS_AMOUNT &gt;=#{amountS,jdbcType=DECIMAL}
		 </if>
		 <if test="amountE != ''">
		 	 and T.TRANS_AMOUNT &lt;=#{amountE,jdbcType=DECIMAL}
		 </if>
	  </where>  
         ORDER BY T.TRANS_DATE,T.LAUNCH_TELLERID,T.DOC_ID
  </select>
  
  <select id="selectVoucherList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
    SELECT BATCH_ID,SERIAL_NO,FORM_NAME,PS_LEVEL,FILE_NAME,BACK_FILE_NAME ,PRIMARY_INCCODEIN ,IS_FRONT_PAGE,CONTENT_ID,DATA_SOURCE_ID 
    FROM
      <if test="dataTb.indexOf('HIS') != -1  or dataTb.indexOf('his') != -1">
          BP_TMPDATA_1_TB_HIS
      </if>
      <if test="dataTb.indexOf('HIS') == -1 and dataTb.indexOf('his') == -1">
          BP_TMPDATA_1_TB
      </if>
    where SELF_DELETE = 0 AND (PRIMARY_INCCODEIN=#{inccodeinBatch,jdbcType=DECIMAL} OR INCCODEIN_BATCH=#{inccodeinBatch,jdbcType=DECIMAL}) 
    AND BATCH_ID=#{batchId,jdbcType=VARCHAR} ORDER BY PRIMARY_INCCODEIN, INCCODEIN_BATCH
  </select>
  
  <select id="getImageInfoList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	select ${imageQueryFields} from BP_TMPDATA_1_TB
	<where> 	
		<if test="serialNo != null and serialNo != ''">
	        and SERIAL_NO=#{serialNo,jdbcType=VARCHAR}
	    </if>
	    <if test="checkFlag != null and checkFlag != ''">
	        and CHECK_FLAG=#{checkFlag,jdbcType=VARCHAR}
	    </if>
	    <if test="batchId != null and batchId != ''">
	        and BATCH_ID=#{batchId,jdbcType=VARCHAR}
	    </if>
	</where>
	order by INCCODEIN_BATCH
  </select> 
  
  <!--根据条件查询图像信息  -->
	<select id="selectDataBySelective" parameterType="java.util.HashMap" resultMap="BaseResultMap">
	SELECT
	<include refid="Base_Column_List" />
	FROM BP_TMPDATA_1_TB
	<where>
		<if test="serialNo !=null and serialNo!=''">
			AND SERIAL_NO = #{serialNo}
		</if>
		<if test="batchId != null and batchId != ''">
			AND BATCH_ID = #{batchId,jdbcType=CHAR}
		</if>
		<if test="fileName != null and fileName !=''">
			AND FILE_NAME = #{fileName,jdbcType=VARCHAR}
		</if>
		<if test="copyInccodein != null">
			AND COPY_INCCODEIN = #{copyInccodein,jdbcType=DECIMAL}
		</if>
		<if test="checkFlag != null and checkFlag != ''">
			AND CHECK_FLAG = #{checkFlag,jdbcType=VARCHAR}
		</if>
	</where>
	ORDER BY INCCODEIN_BATCH
</select>


  <!--获取未处理图像数量-->
  <select id="selectNotDealImage" parameterType="java.util.HashMap" resultType="java.lang.Integer">
	SELECT COUNT(B.SERIAL_NO) FROM bp_tmpdata_1_tb B JOIN BP_TMPBATCH_TB A ON B.BATCH_ID = A.BATCH_ID
    <where>
    	<if test="selfDelete != null">
	        AND B.SELF_DELETE = #{selfDelete,jdbcType=CHAR}
	    </if>
    	<if test="checkFlag != null">
	        AND B.CHECK_FLAG = #{checkFlag,jdbcType=VARCHAR}
	    </if>
	    <if test="isInvalid != null">
	        AND A.IS_INVALID = #{isInvalid,jdbcType=VARCHAR}
	    </if>
	    <if test="needProcess != null">
	        AND A.NEED_PROCESS = #{needProcess,jdbcType=VARCHAR}
	    </if>
	    <if test="operatorNo != null">
	        AND A.OPERATOR_NO = #{operatorNo,jdbcType=VARCHAR}
	    </if>
	    <if test="siteNo != null">
	        AND A.SITE_NO = #{siteNo,jdbcType=VARCHAR}
	    </if>
	    <if test="occurDate != null">
	        AND A.OCCUR_DATE = #{occurDate,jdbcType=VARCHAR}
	    </if>
    </where>
  </select>
  

  
    <select id="selectPatchImageCount" parameterType="java.util.HashMap" resultType="java.lang.Integer">
    select count(1) from
        <if test="dataTb.indexOf('HIS') != -1  or dataTb.indexOf('his') != -1">
            BP_TMPDATA_1_TB_HIS
        </if>
        <if test="dataTb.indexOf('HIS') == -1 and dataTb.indexOf('his') == -1">
            BP_TMPDATA_1_TB
        </if>
    where substr(PROCESS_STATE,4,1)='1'
	<if test="batchList != null">
		and BATCH_ID IN
		<foreach collection="batchList" item="batchId" open="(" separator="," close=")">
			#{batchId}
		</foreach>
	</if>
  </select>
  
  <select id="selectPatchTaskImageCount" parameterType="java.util.HashMap" resultType="java.lang.Integer">
  	SELECT COUNT(1) FROM BP_PATCHTASK_TB WHERE STATUS = '0'
  	<if test="batchList != null">
		and BATCH_ID IN
		<foreach collection="batchList" item="batchId" open="(" separator="," close=")">
			#{batchId}
		</foreach>
	</if>
  </select>

  <select id="deleteArchiveBatchData"  parameterType="java.util.HashMap">
  	DELETE FROM BP_TMPDATA_1_TB T WHERE EXISTS(SELECT B.BATCH_ID FROM BP_TMPBATCH_TB B WHERE T.BATCH_ID=B.BATCH_ID 
   	<where>
   		<if test="occurDate != null">
       	AND OCCUR_DATE = #{occurDate,jdbcType=VARCHAR}
      </if>
      <if test="operatorNo != null">
      	AND  OPERATOR_NO = #{operatorNo,jdbcType=VARCHAR}
      </if>
   	<if test="siteNo != null">
   		AND SITE_NO = #{siteNo,jdbcType=VARCHAR}
   	</if>
   		AND ((B.IMAGE_STATUS = '2' AND B.PROGRESS_FLAG= '99' ) OR B.IS_INVALID= '0'))
   </where>
  </select>
  <update id="updateErrorFlag">
 	 update BP_TMPDATA_1_TB set ERROR_FLAG='1' where SERIAL_NO=#{serialNo,jdbcType=VARCHAR}
  	</update>

  <!--获取一套主附件-->
  <select id="selByInccodein" parameterType="java.util.HashMap" resultType="java.util.HashMap">
    SELECT
    <include refid="Base_Column_List" />
    FROM ${tableName}
     where batch_id=#{batchId}
    and (inccodein_Batch=#{inccodeinBatch} or primary_Inccodein=#{inccodeinBatch})
    order by ps_Level desc, inccodein_Batch asc

  </select>

  <!--看图时查询影像信息-->
  <select id="selectDataNps" parameterType="java.util.HashMap" resultMap="BaseResultMap">
    SELECT
    <include refid="Base_Column_List" />
    FROM
    <if test="dataTb.indexOf('HIS') != -1  or dataTb.indexOf('his') != -1">
      BP_TMPDATA_1_TB_HIS
    </if>
    <if test="dataTb.indexOf('HIS') == -1 and dataTb.indexOf('his') == -1">
      BP_TMPDATA_1_TB
    </if>
    <where>
      <if test="serialNo !=null and serialNo!=''">
        AND SERIAL_NO = #{serialNo}
      </if>
      <if test="batchId != null and batchId != ''">
        AND BATCH_ID = #{batchId,jdbcType=CHAR}
      </if>
      <if test="fileName != null and fileName !=''">
        AND (FILE_NAME = #{fileName,jdbcType=VARCHAR}  or BACK_FILE_NAME = #{fileName,jdbcType=VARCHAR})
      </if>
      <if test="copyInccodein != null">
        AND COPY_INCCODEIN = #{copyInccodein,jdbcType=DECIMAL}
      </if>
      <if test="checkFlag != null and checkFlag != ''">
        AND CHECK_FLAG = #{checkFlag,jdbcType=VARCHAR}
      </if>
    </where>
    ORDER BY INCCODEIN_BATCH
  </select>

</mapper>