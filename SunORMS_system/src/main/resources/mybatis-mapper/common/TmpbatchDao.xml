<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sunyard.ars.file.dao.ma.TmpbatchDao">

  <select id="select" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	SELECT T.BATCH_ID,T.OCCUR_DATE,T.SITE_NO,T.OPERATOR_NO,T.OCR_FACTOR_FLAG,T.PROCINSTID,W.WKI_ID,W.WKI_USER,W.WKI_STATE  
	FROM SUNARS.BP_TMPBATCH_TB T LEFT JOIN SUNFLOW.WORKITEM W ON W.WKI_PRIID = T.PROCINSTID 
	<where> 
	T.PROGRESS_FLAG = '30'  AND T.IS_INVALID = '1'  AND W.WKI_STATE IN ( 2,4,5 )
	AND T.SITE_NO IN (
		SELECT U.ORGAN_NO FROM SUNARS.SM_USER_ORGAN_TB U WHERE U.USER_NO =  #{userNo,jdbcType=VARCHAR}	
	)
	    <if test="operatorNo != null and operatorNo != ''">
	        AND T.OPERATOR_NO = #{operatorNo,jdbcType=VARCHAR}
	    </if>
	      <if test="siteNo != null and siteNo != ''">
	        AND T.SITE_NO = #{siteNo,jdbcType=VARCHAR}
	    </if>
	    <if test="occurDate != null and occurDate != ''">
	        AND T.OCCUR_DATE = #{occurDate,jdbcType=VARCHAR}
	    </if>
	    <if test="batchId != null and batchId != ''">
	        AND T.BATCH_ID = #{batchId,jdbcType=VARCHAR}
	    </if>
	   
	</where>
  </select> 

  
   <select id="selectLock" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	SELECT T.BATCH_ID,T.OCCUR_DATE,T.SITE_NO,T.OPERATOR_NO,T.OCR_FACTOR_FLAG,T.PROCINSTID,W.WKI_ID,W.WKI_USER,W.WKI_STATE  
	FROM SUNARS.BP_TMPBATCH_TB T LEFT JOIN SUNFLOW.WORKITEM W ON W.WKI_PRIID = T.PROCINSTID 
	<where> 
	 T.IS_INVALID = '1' AND BATCH_LOCK = '1' 
	AND T.SITE_NO IN (
		SELECT U.ORGAN_NO FROM SUNARS.SM_USER_ORGAN_TB U WHERE U.USER_NO =  #{userNo,jdbcType=VARCHAR}	
	)
	    <if test="operatorNo != null and operatorNo != ''">
	        AND T.OPERATOR_NO = #{operatorNo,jdbcType=VARCHAR}
	    </if>
	      <if test="siteNo != null and siteNo != ''">
	        AND T.SITE_NO = #{siteNo,jdbcType=VARCHAR}
	    </if>
	    <if test="occurDate != null and occurDate != ''">
	        AND T.OCCUR_DATE = #{occurDate,jdbcType=VARCHAR}
	    </if>
	    <if test="batchId != null and batchId != ''">
	        AND T.BATCH_ID = #{batchId,jdbcType=VARCHAR}
	    </if>
	   
	</where>
  </select> 
  </mapper>
  
 