<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sunyard.ars.system.dao.busm.UserRoleMapper" >
  <resultMap id="BaseResultMap" type="com.sunyard.ars.system.bean.busm.UserRole" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="USER_NO" property="userNo" jdbcType="VARCHAR" />
    <id column="ROLE_NO" property="roleNo" jdbcType="VARCHAR" />
    <id column="IS_OPEN" property="isOpen" jdbcType="CHAR" />
    <id column="BANK_NO" property="bankNo" jdbcType="VARCHAR" />
    <id column="SYSTEM_NO" property="systemNo" jdbcType="VARCHAR" />
    <id column="PROJECT_NO" property="projectNo" jdbcType="VARCHAR" />
    <result column="ORGAN_NO" property="organNo" jdbcType="VARCHAR" />
    <result column="IS_LOCK" property="isLock" jdbcType="VARCHAR" />
    <result column="LAST_MODI_DATE" property="lastModiDate" jdbcType="CHAR" />
    <result column="ROLE_NAME" property="roleName" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    A.USER_NO, A.ROLE_NO, A.IS_OPEN, A.BANK_NO, A.SYSTEM_NO, A.PROJECT_NO, A.ORGAN_NO, A.IS_LOCK, A.LAST_MODI_DATE,B.ROLE_NAME
  </sql>
  <delete id="deleteByPrimaryKey" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from SM_USER_ROLE_TB
    where USER_NO = #{userNo,jdbcType=VARCHAR}
      and ROLE_NO = #{roleNo,jdbcType=VARCHAR}
      and IS_OPEN = #{isOpen,jdbcType=CHAR}
      and BANK_NO = #{bankNo,jdbcType=VARCHAR}
      and SYSTEM_NO = #{systemNo,jdbcType=VARCHAR}
      and PROJECT_NO = #{projectNo,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.sunyard.ars.system.bean.busm.UserRole" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into SM_USER_ROLE_TB (USER_NO, ROLE_NO, IS_OPEN, 
      BANK_NO, SYSTEM_NO, PROJECT_NO, 
      ORGAN_NO, IS_LOCK, LAST_MODI_DATE
      )
    values (#{userNo,jdbcType=VARCHAR}, #{roleNo,jdbcType=VARCHAR}, #{isOpen,jdbcType=CHAR}, 
      #{bankNo,jdbcType=VARCHAR}, #{systemNo,jdbcType=VARCHAR}, #{projectNo,jdbcType=VARCHAR}, 
      #{organNo,jdbcType=VARCHAR}, #{isLock,jdbcType=VARCHAR}, #{lastModiDate,jdbcType=CHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.sunyard.ars.system.bean.busm.UserRole" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into SM_USER_ROLE_TB
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="userNo != null" >
        USER_NO,
      </if>
      <if test="roleNo != null" >
        ROLE_NO,
      </if>
      <if test="isOpen != null" >
        IS_OPEN,
      </if>
      <if test="bankNo != null" >
        BANK_NO,
      </if>
      <if test="systemNo != null" >
        SYSTEM_NO,
      </if>
      <if test="projectNo != null" >
        PROJECT_NO,
      </if>
      <if test="organNo != null" >
        ORGAN_NO,
      </if>
      <if test="isLock != null" >
        IS_LOCK,
      </if>
      <if test="lastModiDate != null" >
        LAST_MODI_DATE,
      </if>
       <if test="isTransmit != null" >
        is_transmit,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="userNo != null" >
        #{userNo,jdbcType=VARCHAR},
      </if>
      <if test="roleNo != null" >
        #{roleNo,jdbcType=VARCHAR},
      </if>
      <if test="isOpen != null" >
        #{isOpen,jdbcType=CHAR},
      </if>
      <if test="bankNo != null" >
        #{bankNo,jdbcType=VARCHAR},
      </if>
      <if test="systemNo != null" >
        #{systemNo,jdbcType=VARCHAR},
      </if>
      <if test="projectNo != null" >
        #{projectNo,jdbcType=VARCHAR},
      </if>
      <if test="organNo != null" >
        #{organNo,jdbcType=VARCHAR},
      </if>
      <if test="isLock != null" >
        #{isLock,jdbcType=VARCHAR},
      </if>
      <if test="lastModiDate != null" >
        #{lastModiDate,jdbcType=CHAR},
      </if>
       <if test="isTransmit != null" >
        #{isTransmit,jdbcType=CHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.sunyard.ars.system.bean.busm.UserRole" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update SM_USER_ROLE_TB
    <set >
      <if test="organNo != null" >
        ORGAN_NO = #{organNo,jdbcType=VARCHAR},
      </if>
      <if test="isLock != null" >
        IS_LOCK = #{isLock,jdbcType=VARCHAR},
      </if>
      <if test="lastModiDate != null" >
        LAST_MODI_DATE = #{lastModiDate,jdbcType=CHAR},
      </if>
    </set>
    where USER_NO = #{userNo,jdbcType=VARCHAR}
      and ROLE_NO = #{roleNo,jdbcType=VARCHAR}
      and IS_OPEN = #{isOpen,jdbcType=CHAR}
      and BANK_NO = #{bankNo,jdbcType=VARCHAR}
      and SYSTEM_NO = #{systemNo,jdbcType=VARCHAR}
      and PROJECT_NO = #{projectNo,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.sunyard.ars.system.bean.busm.UserRole" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update SM_USER_ROLE_TB
    set ORGAN_NO = #{organNo,jdbcType=VARCHAR},
      IS_LOCK = #{isLock,jdbcType=VARCHAR},
      LAST_MODI_DATE = #{lastModiDate,jdbcType=CHAR}
    where USER_NO = #{userNo,jdbcType=VARCHAR}
      and ROLE_NO = #{roleNo,jdbcType=VARCHAR}
      and IS_OPEN = #{isOpen,jdbcType=CHAR}
      and BANK_NO = #{bankNo,jdbcType=VARCHAR}
      and SYSTEM_NO = #{systemNo,jdbcType=VARCHAR}
      and PROJECT_NO = #{projectNo,jdbcType=VARCHAR}
  </update>
<!-- ///////////////////////////////////////////////////// -->
  <select id="selectBySelective" parameterType="map" resultMap="BaseResultMap">
  	select 
  	<include refid="Base_Column_List" />
    from SM_USER_ROLE_TB A join sm_role_tb B on A.role_no=B.role_no  
    <where>
      <if test="userRole.organNo != null and userRole.organNo !=''" >
        AND A.ORGAN_NO = #{userRole.organNo,jdbcType=VARCHAR}
      </if>
      <if test="userRole.userNo != null and userRole.userNo !=''" >
        AND A.USER_NO = #{userRole.userNo,jdbcType=VARCHAR}
      </if>
      <if test="userRole.roleNo != null and userRole.roleNo !=''" >
        AND A.ROLE_NO = #{userRole.roleNo,jdbcType=VARCHAR}
      </if>
      <if test="userRole.isOpen != null and userRole.isOpen !=''" >
        AND A.IS_OPEN = #{userRole.isOpen,jdbcType=VARCHAR}
      </if>
      <if test="userRole.isLock != null" >
        AND A.IS_LOCK = #{userRole.isLock,jdbcType=VARCHAR}
      </if>
      <if test="userRole.lastModiDate != null and userRole.lastModiDate !=''" >
        AND A.LAST_MODI_DATE = #{userRole.lastModiDate,jdbcType=CHAR}
      </if>
      <if test="userRole.bankNo != null and userRole.bankNo !='' and hasPrivOrganFlag != 0" >
       	AND A.ORGAN_NO IN (SELECT ORGAN_NO FROM SM_USER_ORGAN_TB WHERE USER_NO=#{userRole.bankNo,jdbcType=VARCHAR})
      </if>
      <if test="userRole.bankNo != null and userRole.bankNo !='' and hasPrivOrganFlag == 0" >
       AND EXISTS (select 1
			from sm_organ_tb sot, sm_organ_parent_tb sopt
			where
			exists (select 1
			from sm_users_tb sut
			where sut.user_no = #{userRole.bankNo,jdbcType=VARCHAR}
			and sot.organ_no = sut.organ_no)
			and sot.organ_no = sopt.parent_organ
			and sopt.organ_no=A.ORGAN_NO
			)
      </if>
      	AND (A.IS_TRANSMIT !=#{userRole.isTransmit,jdbcType=CHAR}or A.IS_TRANSMIT is NULL)
    </where>
    order by A.USER_NO,A.ORGAN_NO
  </select>
  <update id="updateUserRoleSelective">
  	update SM_USER_ROLE_TB
  	<set >
      <if test="userRoleNew.organNo != null and userRoleNew.organNo !=''" >
        ORGAN_NO = #{userRoleNew.organNo,jdbcType=VARCHAR},
      </if>
      <if test="userRoleNew.userNo != null and userRoleNew.userNo !=''" >
        USER_NO = #{userRoleNew.userNo,jdbcType=VARCHAR},
      </if>
      <if test="userRoleNew.roleNo != null and userRoleNew.roleNo !=''" >
        ROLE_NO = #{userRoleNew.roleNo,jdbcType=VARCHAR},
      </if>
      <if test="userRoleNew.isOpen != null and userRoleNew.isOpen !=''" >
        IS_OPEN = #{userRoleNew.isOpen,jdbcType=VARCHAR},
      </if>
      <if test="userRoleNew.isLock != null" >
        IS_LOCK = #{userRoleNew.isLock,jdbcType=VARCHAR},
      </if>
      <if test="userRoleNew.lastModiDate != null" >
        LAST_MODI_DATE = #{userRoleNew.lastModiDate,jdbcType=CHAR},
      </if>
    </set>
    <where>
      <if test="userRoleOld.organNo != null and userRoleOld.organNo !=''" >
        ORGAN_NO = #{userRoleOld.organNo,jdbcType=VARCHAR}
      </if>
      <if test="userRoleOld.userNo != null and userRoleOld.userNo !=''" >
        AND USER_NO = #{userRoleOld.userNo,jdbcType=VARCHAR}
      </if>
      <if test="userRoleOld.roleNo != null and userRoleOld.roleNo !=''" >
        AND ROLE_NO = #{userRoleOld.roleNo,jdbcType=VARCHAR}
      </if>
      <if test="userRoleOld.isOpen != null and userRoleOld.isOpen !=''" >
        AND IS_OPEN = #{userRoleOld.isOpen,jdbcType=VARCHAR}
      </if>
      <if test="userRoleOld.isLock != null" >
        AND IS_LOCK = #{userRoleOld.isLock,jdbcType=VARCHAR}
      </if>
      <if test="userRoleOld.lastModiDate != null and userRoleOld.lastModiDate !=''" >
        AND LAST_MODI_DATE = #{userRoleOld.lastModiDate,jdbcType=CHAR}
      </if>
    </where>
  </update>
  
  <delete id="deleteByUserNoAndRoleNo" parameterType="map" >
    delete from SM_USER_ROLE_TB
    where USER_NO = #{userNo,jdbcType=VARCHAR}
      and ROLE_NO = #{roleNo,jdbcType=VARCHAR}
  </delete>

  <delete id="deleteByUserNoAndRoleNoAndIsTrans1"  parameterType="map" >
  	   delete from SM_USER_ROLE_TB
   	  where USER_NO = #{userNo,jdbcType=VARCHAR}
      and IS_TRANSMIT='1'
  </delete>
  
  <select id="selectIsExist" parameterType="com.sunyard.ars.system.bean.busm.UserRole" resultType="com.sunyard.ars.system.bean.busm.UserRole">
  		select * from  SM_USER_ROLE_TB where USER_NO=#{userNo,jdbcType=VARCHAR} and IS_TRANSMIT=#{isTransmit,jdbcType=VARCHAR}
  </select>
  
  <!--根据用户查询当前人的角色集合-->
  <select id="getRolesByUserNo" parameterType="java.lang.String" resultMap="BaseResultMap">
  		select ROLE_NO from  SM_USER_ROLE_TB where USER_NO=#{userNo,jdbcType=VARCHAR} 
  </select>
  
 <delete id="deleteRolesByUserNo"  parameterType="java.lang.String" >
  	  	   delete from SM_USER_ROLE_TB  where USER_NO = #{userNo,jdbcType=VARCHAR}
 </delete>  
  

   <select id="selectBySelectiveOfMine" parameterType="com.sunyard.ars.system.bean.busm.UserRole" resultMap="BaseResultMap">
  	select *
    from SM_USER_ROLE_TB A 
    <where>
      <if test="userNo != null and userNo !=''" >
        AND A.USER_NO = #{userNo,jdbcType=VARCHAR}
      </if>
      	AND (A.IS_TRANSMIT !=#{isTransmit,jdbcType=CHAR}or A.IS_TRANSMIT is NULL)
    </where>
  </select>
</mapper>