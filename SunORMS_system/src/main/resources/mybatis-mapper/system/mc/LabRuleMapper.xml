<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sunyard.ars.system.dao.mc.LabRuleMapper">
  <resultMap id="BaseResultMap" type="com.sunyard.ars.system.pojo.mc.LabRule">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="ID" jdbcType="DECIMAL" property="id" />
    <result column="ROWNO" jdbcType="DECIMAL" property="rowno" />
    <result column="MODEL_ID" jdbcType="DECIMAL" property="modelId" />
    <result column="VERSION_ID" jdbcType="DECIMAL" property="versionId" />
    <result column="TABLE_ID" jdbcType="DECIMAL" property="tableId" />
    <result column="FIELD_ID" jdbcType="DECIMAL" property="fieldId" />
    <result column="OPERATOR" jdbcType="CHAR" property="operator" />
    <result column="VALUE" jdbcType="VARCHAR" property="value" />
    <result column="REL_TABLE" jdbcType="DECIMAL" property="relTable" />
    <result column="REL_FIELD" jdbcType="DECIMAL" property="relField" />
    <result column="COMPOSITE_TYPE" jdbcType="CHAR" property="compositeType" />
    <result column="BRACKET_LEFT" property="bracketLeft" jdbcType="VARCHAR" />
    <result column="BRACKET_RIGHT" property="bracketRight" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    ID, ROWNO, MODEL_ID, VERSION_ID, TABLE_ID, FIELD_ID, OPERATOR, VALUE, REL_TABLE, 
    REL_FIELD, COMPOSITE_TYPE,BRACKET_LEFT,BRACKET_RIGHT
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.math.BigDecimal" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from LAB_RULE_TB
    where ID = #{id,jdbcType=DECIMAL}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.math.BigDecimal">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from LAB_RULE_TB
    where ID = #{id,jdbcType=DECIMAL}
  </delete>
  <insert id="insert" parameterType="com.sunyard.ars.system.pojo.mc.LabRule">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into LAB_RULE_TB (ID, ROWNO, MODEL_ID, 
      VERSION_ID, TABLE_ID, FIELD_ID, 
      OPERATOR, VALUE, REL_TABLE, 
      REL_FIELD, COMPOSITE_TYPE,BRACKET_LEFT,BRACKET_RIGHT)
    values (#{id,jdbcType=DECIMAL}, #{rowno,jdbcType=DECIMAL}, #{modelId,jdbcType=DECIMAL}, 
      #{versionId,jdbcType=DECIMAL}, #{tableId,jdbcType=DECIMAL}, #{fieldId,jdbcType=DECIMAL}, 
      #{operator,jdbcType=CHAR}, #{value,jdbcType=VARCHAR}, #{relTable,jdbcType=DECIMAL}, 
      #{relField,jdbcType=DECIMAL}, #{compositeType,jdbcType=CHAR},#{bracketLeft},#{bracketRight})
  </insert>
  <insert id="insertSelective" parameterType="com.sunyard.ars.system.pojo.mc.LabRule">
     	<selectKey resultType="INTEGER" order="BEFORE" keyProperty="id">  
  	 select case when max(id)+1 is null then 1 else max(id)+1 end as id   from LAB_RULE_TB
	</selectKey> 
    insert into LAB_RULE_TB
    <trim prefix="(" suffix=")" suffixOverrides=",">
        ID,
      <if test="rowno != null">
        ROWNO,
      </if>
      <if test="modelId != null">
        MODEL_ID,
      </if>
      <if test="versionId != null">
        VERSION_ID,
      </if>
      <if test="tableId != null">
        TABLE_ID,
      </if>
      <if test="fieldId != null">
        FIELD_ID,
      </if>
      <if test="operator != null">
        OPERATOR,
      </if>
      <if test="value != null">
        VALUE,
      </if>
      <if test="relTable != null">
        REL_TABLE,
      </if>
      <if test="relField != null">
        REL_FIELD,
      </if>
      <if test="compositeType != null">
        COMPOSITE_TYPE,
      </if>
      <if test="bracketLeft != null">
        BRACKET_LEFT,
      </if>
      <if test="bracketRight != null">
        BRACKET_RIGHT,
      </if>
      
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
       #{id,jdbcType=DECIMAL},
      <if test="rowno != null">
        #{rowno,jdbcType=DECIMAL},
      </if>
      <if test="modelId != null">
        #{modelId,jdbcType=DECIMAL},
      </if>
      <if test="versionId != null">
        #{versionId,jdbcType=DECIMAL},
      </if>
      <if test="tableId != null">
        #{tableId,jdbcType=DECIMAL},
      </if>
      <if test="fieldId != null">
        #{fieldId,jdbcType=DECIMAL},
      </if>
      <if test="operator != null">
        #{operator,jdbcType=CHAR},
      </if>
      <if test="value != null">
        #{value,jdbcType=VARCHAR},
      </if>
      <if test="relTable != null">
        #{relTable,jdbcType=DECIMAL},
      </if>
      <if test="relField != null">
        #{relField,jdbcType=DECIMAL},
      </if>
      <if test="compositeType != null">
        #{compositeType,jdbcType=CHAR},
      </if>
      <if test="bracketLeft != null">
        #{bracketLeft,jdbcType=VARCHAR},
      </if>
      <if test="bracketRight != null">
        #{bracketRight,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.sunyard.ars.system.pojo.mc.LabRule">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update LAB_RULE_TB
    <set>
      <if test="rowno != null">
        ROWNO = #{rowno,jdbcType=DECIMAL},
      </if>
      <if test="modelId != null">
        MODEL_ID = #{modelId,jdbcType=DECIMAL},
      </if>
      <if test="versionId != null">
        VERSION_ID = #{versionId,jdbcType=DECIMAL},
      </if>
      <if test="tableId != null">
        TABLE_ID = #{tableId,jdbcType=DECIMAL},
      </if>
      <if test="fieldId != null">
        FIELD_ID = #{fieldId,jdbcType=DECIMAL},
      </if>
      <if test="operator != null">
        OPERATOR = #{operator,jdbcType=CHAR},
      </if>
      <if test="value != null">
        VALUE = #{value,jdbcType=VARCHAR},
      </if>
      <if test="relTable != null">
        REL_TABLE = #{relTable,jdbcType=DECIMAL},
      </if>
      <if test="relField != null">
        REL_FIELD = #{relField,jdbcType=DECIMAL},
      </if>
      <if test="compositeType != null">
        COMPOSITE_TYPE = #{compositeType,jdbcType=CHAR},
      </if>
      
      <if test="bracketLeft != null">
        BRACKET_LEFT = #{bracketLeft,jdbcType=VARCHAR},
      </if>
      <if test="bracketRight != null">
        BRACKET_RIGHT= #{bracketRight,jdbcType=VARCHAR},
      </if>
    </set>
    where ID = #{id,jdbcType=DECIMAL}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.sunyard.ars.system.pojo.mc.LabRule">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update LAB_RULE_TB
    set ROWNO = #{rowno,jdbcType=DECIMAL},
      MODEL_ID = #{modelId,jdbcType=DECIMAL},
      VERSION_ID = #{versionId,jdbcType=DECIMAL},
      TABLE_ID = #{tableId,jdbcType=DECIMAL},
      FIELD_ID = #{fieldId,jdbcType=DECIMAL},
      OPERATOR = #{operator,jdbcType=CHAR},
      VALUE = #{value,jdbcType=VARCHAR},
      REL_TABLE = #{relTable,jdbcType=DECIMAL},
      REL_FIELD = #{relField,jdbcType=DECIMAL},
      COMPOSITE_TYPE = #{compositeType,jdbcType=CHAR},
      BRACKET_LEFT = #{bracketLeft,jdbcType=VARCHAR},
      BRACKET_RIGHT= #{bracketRight,jdbcType=VARCHAR}
    where ID = #{id,jdbcType=DECIMAL}
  </update>
  
  <select id="queryJobDate" resultType="java.lang.String">
  	select job_date from qrtz_job_date
  </select>
  
  
  <select id="queryMaxRowId" resultType="java.lang.Integer">
    select NVL(max(rowno),0) from (select max(ENTRYROW_ID) rowno from ${tableName}  UNION select max(ENTRYROW_ID) rowno from ${tableName}_His)
  </select>
  
  <select id="queryLabRule" parameterType="com.sunyard.ars.system.pojo.mc.LabRule"
	resultType="map">
SELECT T6.*,T7.Name rel_Field_name, T7.CH_NAME CH_REL_FIELD
  FROM (SELECT T4.*,
               T5.TABLE_NAME REL_TABLENAME,
               T5.TABLE_DESC REL_TABLEDESC
          FROM (SELECT T1.*,
                       T2.TABLE_NAME,
                       T2.TABLE_DESC,
                       T3.Name Field_name,
                       T3.CH_NAME CH_FIELD_NAME
                  FROM LAB_RULE_TB T1, MC_TABLE_TB T2, MC_FIELD_TB T3
	<where>
		t1.table_id=t2.id
		  AND T3.ID = T1.FIELD_ID
		<if test="modelId !=null and modelId!='' ">
			and model_id= #{modelId,jdbcType=INTEGER}
		</if>
		<if test="versionId !=null and versionId !='' ">
			and version_id= #{versionId,jdbcType=INTEGER}
		</if>
	</where>
	 ) T4
           LEFT JOIN MC_TABLE_TB T5
            ON T5.ID = T4.REL_TABLE
         ORDER BY T4.ROWNO) T6
  LEFT JOIN MC_FIELD_TB T7
    ON T6.REL_FIELD = T7.ID
  </select>
  
</mapper>