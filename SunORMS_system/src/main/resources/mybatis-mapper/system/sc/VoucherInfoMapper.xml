<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sunyard.ars.system.dao.sc.VoucherInfoMapper" >
  <resultMap id="BaseResultMap" type="com.sunyard.ars.system.bean.sc.VoucherInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="VOUCHER_ID" property="voucherId" jdbcType="DECIMAL" />
    <result column="VOUCHER_NUMBER" property="voucherNumber" jdbcType="DECIMAL" />
    <result column="VOUCHER_NAME" property="voucherName" jdbcType="VARCHAR" />
    <result column="P_FOLDER_ID" property="pFolderId" jdbcType="DECIMAL" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    VOUCHER_ID, VOUCHER_NUMBER, VOUCHER_NAME, P_FOLDER_ID
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.math.BigDecimal" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from SM_VOUCHER_INFO_TB
    where VOUCHER_ID = #{voucherId,jdbcType=DECIMAL}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.math.BigDecimal" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from SM_VOUCHER_INFO_TB
    where VOUCHER_ID = #{voucherId,jdbcType=DECIMAL}
  </delete>
  <insert id="insert" parameterType="com.sunyard.ars.system.bean.sc.VoucherInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into SM_VOUCHER_INFO_TB (VOUCHER_ID, VOUCHER_NUMBER, VOUCHER_NAME, 
      P_FOLDER_ID)
    values (#{voucherId,jdbcType=DECIMAL}, #{voucherNumber,jdbcType=DECIMAL}, #{voucherName,jdbcType=VARCHAR}, 
      #{pFolderId,jdbcType=DECIMAL})
  </insert>
  <insert id="insertSelective" parameterType="com.sunyard.ars.system.bean.sc.VoucherInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into SM_VOUCHER_INFO_TB
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="voucherId != null" >
        VOUCHER_ID,
      </if>
      <if test="voucherNumber != null" >
        VOUCHER_NUMBER,
      </if>
      <if test="voucherName != null" >
        VOUCHER_NAME,
      </if>
      <if test="pFolderId != null" >
        P_FOLDER_ID,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="voucherId != null" >
        #{voucherId,jdbcType=DECIMAL},
      </if>
      <if test="voucherNumber != null" >
        #{voucherNumber,jdbcType=DECIMAL},
      </if>
      <if test="voucherName != null" >
        #{voucherName,jdbcType=VARCHAR},
      </if>
      <if test="pFolderId != null" >
        #{pFolderId,jdbcType=DECIMAL},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.sunyard.ars.system.bean.sc.VoucherInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update SM_VOUCHER_INFO_TB
    <set >
      <if test="voucherNumber != null" >
        VOUCHER_NUMBER = #{voucherNumber,jdbcType=DECIMAL},
      </if>
      <if test="voucherName != null" >
        VOUCHER_NAME = #{voucherName,jdbcType=VARCHAR},
      </if>
      <if test="pFolderId != null" >
        P_FOLDER_ID = #{pFolderId,jdbcType=DECIMAL},
      </if>
    </set>
    where VOUCHER_ID = #{voucherId,jdbcType=DECIMAL}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.sunyard.ars.system.bean.sc.VoucherInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update SM_VOUCHER_INFO_TB
    set VOUCHER_NUMBER = #{voucherNumber,jdbcType=DECIMAL},
      VOUCHER_NAME = #{voucherName,jdbcType=VARCHAR},
      P_FOLDER_ID = #{pFolderId,jdbcType=DECIMAL}
    where VOUCHER_ID = #{voucherId,jdbcType=DECIMAL}
  </update>
  
  <select id="selectBySelective" parameterType="com.sunyard.ars.system.bean.sc.VoucherInfo" resultMap="BaseResultMap">
   select <include refid="Base_Column_List" /> from SM_VOUCHER_INFO_TB 
   <where>
      <if test="voucherId != null and voucherId != ''" >
        VOUCHER_ID = #{voucherId,jdbcType=DECIMAL}
      </if>
      <if test="voucherNumber != null and voucherNumber != ''" >
        AND VOUCHER_NUMBER = #{voucherNumber,jdbcType=DECIMAL}
      </if>
      <if test="voucherName != null and voucherName != ''" >
        AND VOUCHER_NAME like '%'||#{voucherName,jdbcType=VARCHAR}||'%'
      </if>
      <if test="pFolderId != null and pFolderId != ''" >
        AND P_FOLDER_ID = #{pFolderId,jdbcType=DECIMAL}
      </if>  
      order by VOUCHER_ID asc
   </where>
  </select>
  <select id="getMaxVoucherId" resultType="BigDecimal">
  	select max(VOUCHER_ID) from SM_VOUCHER_INFO_TB
  </select>

    <select id="selectVoucherOnlyByName" parameterType="String" resultType="Integer">
        select count(*) from SM_VOUCHER_INFO_TB
        where VOUCHER_NAME = #{voucherName,jdbcType=VARCHAR}
    </select>

  <!-- 获取所有版面的补录和限制信息 -->
  <select id="selectAllForms" resultType="java.util.HashMap">
	SELECT A.VOUCHER_NUMBER,A.VOUCHER_NAME,B.IS_MULTI,B.CHECK_FIELDS FROM SM_VOUCHER_INFO_TB A LEFT JOIN SM_FORM_MAN_PRO_TB B ON A.VOUCHER_NAME = B.FORM_NAME ORDER BY A.VOUCHER_NUMBER
  </select> 
  <!-- 版面参数获取 -->
  <select id="selectFormMap" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	SELECT VOUCHER_NAME FROM SM_VOUCHER_ORGAN_TB WHERE ORGAN_NO = #{organ_no}  UNION ALL SELECT DISTINCT (T1.VOUCHER_NAME) FROM SM_VOUCHER_INFO_TB T1 WHERE NOT EXISTS (SELECT 1 FROM SM_VOUCHER_ORGAN_TB T2 WHERE T1.VOUCHER_NAME = T2.VOUCHER_NAME)
  </select>
  <select id="selectByVocherName"
	parameterType="java.util.HashMap" resultType="java.util.HashMap">
	select svot.organ_no as "id",
	concat(concat(sot.organ_no,'-'),sot.organ_name) as "name",
	sot.parent_organ as "pId",
	sot.organ_level
	from sm_voucher_organ_tb svot
	left join sm_organ_tb sot
	on svot.organ_no = sot.organ_no
	<where>
		voucher_name =#{voucherName,jdbcType=VARCHAR}
	</where>
	  order by svot.organ_no asc
</select>
	<insert id="insertOrgan" parameterType="java.util.HashMap">
	<if
		test="organNo != null and organNo !='' and voucherName != null and voucherName != ''">
		insert into sm_voucher_organ_tb values(
		#{voucherName,jdbcType=VARCHAR},#{organNo,jdbcType=VARCHAR})
	</if>
</insert>

 <select id="selectVoucherInfoAndCNT"
	parameterType="com.sunyard.ars.system.bean.sc.VoucherInfo"
	resultType="java.util.HashMap">
	select svit.*,svot.cnt
	from sm_voucher_info_tb svit left join
	(select voucher_name, count(*) cnt
	from sm_voucher_organ_tb
	group by voucher_name) svot
	on svit.voucher_name = svot.voucher_name
	<where>
		<if test="voucherId != null and voucherId != ''">
			svit.VOUCHER_ID = #{voucherId,jdbcType=DECIMAL}
		</if>
		<if test="voucherNumber != null and voucherNumber != ''">
			AND svit.VOUCHER_NUMBER = #{voucherNumber,jdbcType=DECIMAL}
		</if>
		<if test="voucherName != null and voucherName != ''">
			AND svit.VOUCHER_NAME like '%'||#{voucherName,jdbcType=VARCHAR}||'%'
		</if>
		<if test="pFolderId != null and pFolderId != ''">
			AND svit.P_FOLDER_ID = #{pFolderId,jdbcType=DECIMAL}
		</if>
	</where>
	order by svit.VOUCHER_ID asc
</select>
	<delete id="deleteByVoucherName">
	delete sm_voucher_organ_tb where voucher_name=#{voucherName,jdbcType=VARCHAR}
   </delete>
	<update id="updateTradeFormInfo">
		UPDATE SM_TRADE_FORM_TB SET FORM_NAME=#{voucherName,jdbcType=VARCHAR} WHERE
		FORM_NAME=#{voucherOldName,jdbcType=VARCHAR}
	</update>
	<update id="updateOcrpreCheckTb">
		UPDATE SM_OCRPRE_CHECK_TB SET FORM_NAME=#{voucherName,jdbcType=VARCHAR}
		WHERE FORM_NAME=#{voucherOldName,jdbcType=VARCHAR}
	</update>
	<update id="updateSmFormManProInfo">
		UPDATE SM_FORM_MAN_PRO_TB SET FORM_NAME=#{voucherName,jdbcType=VARCHAR}
		WHERE FORM_NAME=#{voucherOldName,jdbcType=VARCHAR}
	</update>
	<update id="updateFormInfo">
		UPDATE SM_FORM_INFO_TB SET FORM_NAME=#{voucherName,jdbcType=VARCHAR} WHERE
		FORM_NAME=#{voucherOldName,jdbcType=VARCHAR}
	</update>


</mapper>